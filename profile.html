<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Player Profile • Hamilton YATSTATS</title>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400&family=Bebas+Neue&display=swap" rel="stylesheet">

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    
    window.firebaseAuth = { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously };

    try {
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        
        onAuthStateChanged(window.auth, user => {
            const event = new CustomEvent('authStateChanged', { detail: { user } });
            document.dispatchEvent(event);
        });

        if (window.__initial_auth_token) {
            await signInWithCustomToken(window.auth, window.__initial_auth_token);
        } else {
            await signInAnonymously(window.auth);
        }
    } catch (e) {
        console.error("Firebase initialization error:", e);
    }
</script>

<style>
:root{
  --bg:#0c0c0c; --fg:#f2f2f2; --muted:#c4c4c4; --ink:#e8e8e8; --line:rgba(255,255,255,0.08);
  --hamSmall:13px; --hamBig:20px; --hamBigger:24px;
  --crestH: clamp(50px, 8vw, 70px);
  --pairGap: 16px; --containerPad: 16px; --footerH: clamp(56px, 8vh, 77px);
}
@font-face{ font-family:'Indigo'; src:url('assets/fonts/Indigo.otf') format('opentype');}
*{box-sizing:border-box} html,body{margin:0}
body{background:var(--bg);color:var(--fg);font-family:Oswald,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
body.drawer-open { overflow: hidden; }
a{color:inherit;text-decoration:none}
.container{max-width:1400px;margin:0 auto;padding:0 var(--containerPad)}
.header{position:sticky;top:0;z-index:50;background:#000}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 0; gap: 12px;}
.left-icons, .right-icons {display:flex;align-items:center;gap:8px}
.icon-btn{background:none;border:none;color:var(--fg);opacity:.92;display:inline-flex;align-items:center;justify-content:center;padding:0;margin:0 2px; cursor: pointer;}
.icon-btn i{font-size:20px}
.topnav{display:flex;gap:18px;align-items:center; flex-grow: 1; justify-content: center;}
.nav-pair .thin{font:300 var(--hamSmall) Oswald, sans-serif; letter-spacing:.02em; color:#cfd2d6; margin-right:2px}
.nav-pair .bold{font:400 var(--hamSmall) Indigo, "Bebas Neue", sans-serif}
@media (max-width:1200px){ .topnav{display:none !important} }
.hr-y{border-top:1px solid var(--line)}
.schoolrow{display:flex;align-items:center;gap:var(--pairGap);padding:8px 0}
.ham-logo{height:var(--crestH);width:auto;object-fit:contain;display:block; flex-shrink: 0;}
.schooltext .small{font:300 var(--hamSmall)/1 Oswald;letter-spacing:.02em;color:var(--muted)}
.schooltext .big1{font:400 var(--hamBig)/1 "Bebas Neue",sans-serif}
.schooltext .big2{font:400 var(--hamBigger)/1 "Bebas Neue",sans-serif;margin-top:-4px}
.crumbs{font:300 calc(var(--hamSmall)*.8)/1 Oswald;letter-spacing:.02em;color:var(--muted);text-transform:uppercase; white-space: nowrap;}
.crumbs a:hover { text-decoration: underline; }
.hero{padding:2px 0}
.main{padding:8px 0 calc(var(--footerH) + 12px)}
.site-footer{position:fixed;left:0;right:0;bottom:0;height:var(--footerH);background:#0b0b0b;border-top:1px solid var(--line);z-index:40}
.site-footer .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:0 var(--containerPad)}
.site-footer img{ height:100%; width:100%; object-fit:contain; }
.drawer-mask{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity .2s;z-index:60}
.drawer{position:fixed;top:0;bottom:0;width:min(360px,82vw);background:rgba(10,10,10,.65);backdrop-filter:blur(4px);color:#e8e8e8;transform:translateX(-110%);transition:transform .25s;z-index:70}
.drawer-right{right:0;left:auto;transform:translateX(110%); display: flex; flex-direction: column; height: 100%;}
.drawer h3{margin:18px 16px 8px;}
.drawer .pad { padding: 10px 16px; }
.drawer .close-btn { position: absolute; top: 12px; right: 12px; }
body.drawer-left-open .drawer-mask,body.drawer-right-open .drawer-mask{opacity:1;pointer-events:auto}
body.drawer-left-open #drawerLeft{transform:translateX(0)}
body.drawer-right-open .drawer-right{transform:translateX(0)}
.drawer-content { flex-grow: 1; overflow-y: auto; padding: 10px 16px;}
.live-hit{padding:10px 12px;display:flex;align-items:center;gap:10px;border-radius:10px;cursor:pointer}
.live-hit:hover{background:rgba(255,255,255,.08)}
.live-hit img{width:36px;height:36px;border-radius:6px;object-fit:cover}
.auth-tabs { display: flex; border-bottom: 1px solid var(--line); }
.auth-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; background: transparent; border: none; color: var(--muted); font-family: "Bebas Neue", sans-serif; font-size: 16px; letter-spacing: .05em;}
.auth-tab.active { color: var(--fg); border-bottom: 2px solid var(--fg); }
.auth-form { display: none; }
.auth-form.active { display: block; }
.form-field { margin-bottom: 15px; }
.form-field input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--line); background: rgba(255,255,255,.06); color: var(--ink); }
.auth-btn { width: 100%; padding: 12px; background: var(--fg); color: var(--bg); border: none; border-radius: 8px; font-family: "Bebas Neue", sans-serif; cursor: pointer; }
#authMessage { margin-top: 15px; text-align: center; font-size: 13px; }
.error { color: #fca5a5; }

/* Player Header Details */
.player-header-details { flex-grow: 1; display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; }
.player-header-left-cols, .player-header-right-cols { display: flex; align-items: flex-start; gap: 16px; }
.detail-col { display: flex; flex-direction: column; align-items: flex-start; gap: 6px; }
.detail-col.align-right { align-items: flex-end; text-align: right; }
.front-chip { background: rgba(255,255,255,.1); color: #fff; border-radius: 6px; padding: 2px 6px; font-size: 10px; font-family: Oswald, sans-serif; text-transform: uppercase; }
.varsity-dots { display: flex; gap: 4px; }
.varsity-dot { width: 22px; height: 22px; border-radius: 50%; background: #fff; color: #111; display: grid; place-items: center; font-weight: 700; font-size: 10px; }
.game-title-pill { background: rgba(255,255,255,.1); color: #fff; border-radius: 20px; padding: 3px 10px; font-size: 10px; font-family: Oswald, sans-serif; font-weight: 700; display: inline-block; margin-bottom: 4px; }
.game-data-text { font: 300 13px/1.2 Oswald; }
.game-log { font: 400 10px system-ui, sans-serif; white-space: nowrap; }

/* FUNZONE STYLES */
.profile-nav { display: flex; justify-content: space-around; background: transparent; border-bottom: 1px solid var(--line); padding: 4px 0; }
.profile-nav-link { background: none; border: none; color: var(--muted); font: 700 14px "Bebas Neue", sans-serif; letter-spacing: .08em; cursor: pointer; padding: 8px 10px; border-bottom: 2px solid transparent; }
.profile-nav-link.active { color: var(--fg); border-bottom-color: var(--fg); }
#funzone-container { padding-top: 24px; background: #111; border-radius: 12px; margin-top: 16px; min-height: 50vh; color: var(--ink); }
.funzone-content { animation: fadeIn 0.5s; padding: 16px; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.stats-header-bar { background: #333; color: #fff; text-align: center; padding: 6px; font: 700 12px "Bebas Neue", sans-serif; margin: 0 0 12px; border-radius: 6px;}
.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; text-align: center; }
.stat-item { background: #222; border-radius: 8px; padding: 8px 5px; }
.stat-label { font-size: 11px; text-transform: uppercase; opacity: .7; margin-bottom: 4px; }
.stat-value { font-size: 18px; font-weight: 700; line-height: 1; }

@media (max-width: 992px) { .player-header-details { display: none; } }
</style>
</head>

<body>
<header class="header">
    <div class="container topbar">
        <div class="left-icons">
            <button class="icon-btn" id="btnMenu" aria-label="Menu"><i class="ri-menu-line"></i></button>
            <div id="breadcrumbs" class="crumbs"><a href="index.html">HAMILTON</a> ▸ LOADING...</div>
        </div>
        <nav class="topnav" aria-label="Top Navigation">
            <a href="index.html" class="nav-pair"><span class="thin">WHERE THEY</span><span class="bold">YAT?</span></a>
            <a href="alumni-news.html" class="nav-pair"><span class="thin">ACTIVE ALUMNI</span><span class="bold">NEWS</span></a>
            <a href="all-time-list.html" class="nav-pair"><span class="thin">NEXT-LEVEL</span><span class="bold">ALL-TIME LIST</span></a>
        </nav>
        <div class="right-icons">
            <button class="icon-btn" id="openSearch" aria-label="Search"><i class="ri-search-line"></i></button>
            <div id="auth-container">
                 <button class="icon-btn" id="btnAccount" aria-label="Account"><i class="ri-user-3-line"></i></button>
                 <button class="icon-btn" id="btnSignOut" style="display: none;"><i class="ri-logout-box-line"></i></button>
            </div>
            <button class="icon-btn" onclick="history.back()" aria-label="Go back"><i class="ri-arrow-left-line"></i></button>
        </div>
    </div>
    <div class="hr-y"></div>
    <div class="container schoolrow">
        <img id="playerLogo" class="ham-logo" src="assets/img/placeholder.png" alt="Player Photo">
        <div class="schooltext">
            <div id="playerTeamOrg" class="small">LOADING PLAYER...</div>
            <div id="playerFirstName" class="big1"></div>
            <div id="playerLastName" class="big2"></div>
        </div>
        <div class="player-header-details">
            <div class="player-header-left-cols" id="player-header-left-cols"></div>
            <div class="player-header-right-cols" id="player-header-right-cols"></div>
        </div>
    </div>
    <div class="hr-y"></div>
    <section class="hero">
        <div class="container">
            <nav id="profileNav" class="profile-nav">
                <button class="profile-nav-link active" data-content="stats">STATS</button>
                <button class="profile-nav-link" data-content="bio">BIO</button>
                <button class="profile-nav-link" data-content="news">NEWS</button>
                <button class="profile-nav-link" data-content="social">SOCIAL</button>
                <button class="profile-nav-link" data-content="nil">NIL PTS</button>
                <button class="profile-nav-link" data-content="video">VIDEO</button>
                <button class="profile-nav-link" data-content="pics">FAN PICS</button>
            </nav>
        </div>
    </section>
</header>

<div class="drawer-mask"></div>
<aside class="drawer" id="drawerLeft" aria-label="Left drawer">
    <button class="icon-btn close-btn"><i class="ri-close-line"></i></button>
    <div class="drawer-content">
        <h3>PLAYER PROFILE SEARCH</h3>
        <div class="pad">
            <input id="playerSearch" placeholder="Type to search…" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--ink)">
            <div id="liveResults"></div>
        </div>
        <h3>NAVIGATION</h3>
        <div class="pad" style="display:flex;flex-direction:column;gap:12px">
            <a href="index.html" class="nav-pair"><span class="thin">WHERE THEY</span><span class="bold">YAT?</span></a>
            <a href="alumni-news.html" class="nav-pair"><span class="thin">ACTIVE ALUMNI</span><span class="bold">NEWS</span></a>
            <a href="all-time-list.html" class="nav-pair"><span class="thin">NEXT-LEVEL</span><span class="bold">ALL-TIME LIST</span></a>
            <a href="marketplace.html" class="nav-pair"><span class="thin">NIL & YAT-A-BOY</span><span class="bold">MARKETPLACE</span></a>
            <a href="current-team.html" class="nav-pair"><span class="thin">THE</span><span class="bold">CURRENT TEAM</span></a>
            <a href="partner-program.html" class="nav-pair"><span class="thin">PCD ACTION</span><span class="bold">PARTNER PROGRAM</span></a>
            <a href="faq.html" class="nav-pair"><span class="bold">FAQ’S</span></a>
        </div>
    </div>
</aside>
<aside class="drawer drawer-right" id="drawerAccount">
     <button class="icon-btn close-btn"><i class="ri-close-line"></i></button>
    <h3>ACCOUNT</h3>
    <div class="drawer-content">
        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="signIn">Sign In</button>
            <button class="auth-tab" data-tab="register">Register</button>
        </div>
        <div id="auth-forms-container" class="pad">
            <form id="signInForm" class="auth-form active">
                <div class="form-field"><label for="signInEmail">Email</label><input type="email" id="signInEmail" required></div>
                <div class="form-field"><label for="signInPassword">Password</label><input type="password" id="signInPassword" required></div>
                <button type="submit" class="auth-btn">Sign In</button>
            </form>
            <form id="registerForm" class="auth-form">
                <div class="form-field"><label for="registerEmail">Email</label><input type="email" id="registerEmail" required></div>
                <div class="form-field"><label for="registerPassword">Password</label><input type="password" id="registerPassword" required></div>
                <button type="submit" class="auth-btn">Create Account</button>
            </form>
            <p id="authMessage"></p>
        </div>
    </div>
</aside>

<main class="main container">
  <div id="funzone-container" aria-live="polite">
      <p style="color: var(--muted); padding: 20px;">Loading player data...</p>
  </div>
</main>

<footer class="site-footer">
  <div class="wrap">
    <img src="assets/img/sponsor-1200x120.jpg" alt="Sponsor Banner">
  </div>
</footer>

<script type="module">
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQcWJM6Q6hTdFnES_G5LUy4teCS-sJ5HdAc9F5HSY8DGE9egdGy8yUAe2ShT3tFm-CwUuCYeAYy_YiW/pub?gid=2028135390&single=true&output=csv";
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const debounce = (fn, ms=300)=>{ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; };

async function loadCSV(url){
  const response = await fetch(url);
  const text = await response.text();
  const rows = text.trim().split(/\r?\n/).map(line => line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'')));
  const header = rows.shift().map(h => h.trim());
  const idx=n=>header.indexOf(n);
  const statKeys = ['avg', 'obp', 'slg', 'ops', 'ab', 'h', 'r', 'rbi', '2b', '3b', 'hr', 'sb', 'bb', 'era', 'k/9', 'k/bb', 'whip', 'ip', 'er', 'ko', 'gp', 'w-l', 'saves', 'fip'];
  return rows.map(r=>({
      slug:r[idx('slug')], display_name:r[idx('display_name')],
      first:r[idx('first')], last:r[idx('last')],
      grad_class:r[idx('grad_class')], letter_years:r[idx('letter_years')], status:r[idx('status')], level:r[idx('level')], 
      team:r[idx('team')], org:r[idx('org')],
      next_game_opponent: r[idx('next_game_opponent')],
      next_game_datetime: r[idx('next_game_datetime')],
      last_game_1: r[idx('last_game_1')], last_game_2: r[idx('last_game_2')], last_game_3: r[idx('last_game_3')],
      stats: statKeys.reduce((obj, key) => {
          const statIndex = idx(key);
          if (statIndex > -1 && r[statIndex]) obj[key.toUpperCase()] = r[statIndex];
          return obj;
      }, {})
  }));
}

function slugOf(p){
  return (p.slug||'').trim() || (`${p.first || ''}-${p.last || ''}`).trim().toLowerCase().replace(/[^a-z0-9]+/g,'-');
}

function profileURL(p) { return `./profile.html?player=${slugOf(p)}`; }

function formatStatValue(key, value) {
    if (!value) return '--';
    const decimalStats = ['AVG', 'OBP', 'SLG', 'OPS'];
    if (decimalStats.includes(key) && typeof value === 'string' && value.startsWith('0.')) {
        return value.substring(1);
    }
    return value;
}

async function loadFunZoneContent(content, player) {
    const container = $('#funzone-container');
    let html = '';
    if (content === 'stats') {
        const isPitcher = player.stats['ERA'] !== undefined;
        const batterStats = ['AVG', 'OBP', 'SLG', 'OPS', 'H', 'R', 'HR', 'RBI', 'AB', '2B', '3B', 'SB'];
        const pitcherStats = ['ERA', 'K/9', 'K/BB', 'WHIP', 'IP', 'ER', 'KO', 'BB', 'GP', 'W-L', 'SAVES', 'FIP'];
        const statsToShow = isPitcher ? pitcherStats : batterStats;
        const statsHeader = (player.status || '').toUpperCase().includes('ACTIVE') ? '2025 SEASON STATS' : 'CAREER STATS';

        html = `<div class="funzone-content"><div class="stats-header-bar">${statsHeader}</div><div class="stats-grid">`;
        html += statsToShow.map(stat => {
            const formattedValue = formatStatValue(stat, player.stats[stat]);
            return `<div class="stat-item"><div class="stat-label">${stat}</div><div class="stat-value">${formattedValue}</div></div>`;
        }).join('');
        html += `</div></div>`;
    } else if (content === 'video') {
        html = `<div class="funzone-content"><iframe width="100%" height="400" src="https://www.youtube.com/embed/ZSoRzk-z35w" title="YouTube video player" frameborder="0" allowfullscreen style="border-radius: 8px; max-width: 710px; display: block; margin: 0 auto;"></iframe></div>`;
    } else {
        html = `<div class="funzone-content"><p>Content for ${content} coming soon for ${player.display_name}.</p></div>`;
    }
    container.innerHTML = html;
}

function initializeProfilePage(player) {
    document.title = `${player.display_name} • Hamilton YATSTATS`;
    const imageName = (p => `${(p.first||'').toLowerCase()}_${(p.last||'').toLowerCase()}`)(player);
    $('#playerLogo').src = `assets/img/hs_players/${imageName}.jpg`;
    $('#playerLogo').onerror = () => { $('#playerLogo').src = `assets/img/hs_players/${imageName}.png`; };
    $('#playerTeamOrg').textContent = `${player.team || ''} - ${player.org || ''}`;
    $('#playerFirstName').textContent = player.first;
    $('#playerLastName').textContent = player.last;
    $('#breadcrumbs').innerHTML = `<a href="index.html">HAMILTON</a> ▸ ${player.first.toUpperCase()} ${player.last.toUpperCase()} PROFILE`;

    let col1HTML = `<div class="detail-col">${(player.status ? `<span class="front-chip">${player.status}</span>`:'')}${(player.level ? `<span class="front-chip">${player.level}</span>`:'')}</div>`;
    const letterYears = (player.letter_years || '').split(',').map(y => y.trim().slice(-2)).filter(Boolean);
    let col2HTML = `<div class="detail-col">${(player.grad_class ? `<span class="front-chip">CLASS OF ${player.grad_class}</span>`:'')}${(letterYears.length > 0 ? `<div class="varsity-dots">${letterYears.map(year => `<div class="varsity-dot">${year}</div>`).join('')}</div>`:'')}</div>`;
    $('#player-header-left-cols').innerHTML = col1HTML + col2HTML;
    let col3HTML = ``, col4HTML = ``;
    if (!(player.status || '').toUpperCase().includes('RETIRED')) {
         col3HTML = `<div class="detail-col"><div class="game-title-pill">NEXT GAME</div><div class="game-data-text"><span>${player.next_game_datetime||'TBD'}</span><span>@ ${player.next_game_opponent||'TBD'}</span></div></div>`;
    }
    col4HTML = `<div class="detail-col align-right"><div class="game-title-pill">LAST 3 GAMES</div><div class="game-data-text"><span class="game-log">${player.last_game_1||'--'}</span><span class="game-log">${player.last_game_2||'--'}</span><span class="game-log">${player.last_game_3||'--'}</span></div></div>`;
    $('#player-header-right-cols').innerHTML = col3HTML + col4HTML;

    $$('.profile-nav-link').forEach(link => {
        link.addEventListener('click', () => {
            $$('.profile-nav-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            loadFunZoneContent(link.dataset.content, player);
        });
    });
    loadFunZoneContent('stats', player);
}

function makeHit(p){
  const el=document.createElement('div'); el.className='live-hit';
  const imageName = (p => `${(p.first||'').toLowerCase()}_${(p.last||'').toLowerCase()}`)(p);
  const hsImgJpg=`assets/img/hs_players/${imageName}.jpg`;
  el.innerHTML=`<img src="${hsImgJpg}" onerror="this.onerror=null;this.src='assets/img/placeholder.png';">
                <div><div style="font-weight:700">${p.display_name}</div>
                <div style="opacity:.7;font-size:.92em">${p.level||''} • Class of ${p.grad_class||''}</div></div>`;
  el.onclick=()=>window.location.href=profileURL(p);
  return el;
}
function liveSearch(){
  const q=($('#playerSearch')?.value||'').trim().toLowerCase();
  const box=$('#liveResults'); if(!box) return;
  if(!q){ box.innerHTML=''; return; }
  const hits=(window.ALL_PLAYERS||[]).filter(p=>(p.display_name||'').toLowerCase().includes(q)).slice(0,25);
  box.innerHTML=''; hits.forEach(p=>box.appendChild(makeHit(p)));
}

function setupEventListeners() {
    const closeDrawers = () => document.body.classList.remove('drawer-left-open', 'drawer-right-open', 'drawer-open');
    $('#btnMenu')?.addEventListener('click', () => { $('#drawerAccount').style.display = 'none'; document.body.classList.add('drawer-left-open', 'drawer-open'); });
    $('#openSearch')?.addEventListener('click', () => { $('#drawerAccount').style.display = 'none'; document.body.classList.add('drawer-left-open', 'drawer-open'); });
    $('#btnAccount')?.addEventListener('click', () => { document.body.classList.add('drawer-right-open', 'drawer-open'); });
    $$('.close-btn, .drawer-mask').forEach(el => el.addEventListener('click', closeDrawers));
    $('#playerSearch')?.addEventListener('input', debounce(liveSearch));

    const { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } = window.firebaseAuth;
    const auth = window.auth;
    const authMessage = $('#authMessage');
    $('#signInForm')?.addEventListener('submit', async e => {
        e.preventDefault();
        try {
            await signInWithEmailAndPassword(auth, $('#signInEmail').value, $('#signInPassword').value);
            authMessage.textContent = 'Sign in successful!';
            setTimeout(() => { closeDrawers(); authMessage.textContent = ''; }, 1500);
        } catch (error) { authMessage.textContent = error.message; authMessage.className = 'error'; }
    });
    $('#registerForm')?.addEventListener('submit', async e => {
        e.preventDefault();
        try {
            await createUserWithEmailAndPassword(auth, $('#registerEmail').value, $('#registerPassword').value);
            authMessage.textContent = 'Registration successful!';
            setTimeout(() => { closeDrawers(); authMessage.textContent = ''; }, 1500);
        } catch (error) { authMessage.textContent = error.message; authMessage.className = 'error'; }
    });
    $('#btnSignOut')?.addEventListener('click', () => signOut(auth));
    document.addEventListener('authStateChanged', ({ detail: { user } }) => {
        const loggedIn = user && !user.isAnonymous;
        $('#btnAccount').style.display = loggedIn ? 'none' : 'inline-flex';
        $('#btnSignOut').style.display = loggedIn ? 'inline-flex' : 'none';
    });
    $$('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const target = tab.dataset.tab;
            $$('.auth-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            $$('.auth-form').forEach(form => form.classList.toggle('active', form.id === `${target}Form`));
            authMessage.textContent = '';
        });
    });
}

document.addEventListener('DOMContentLoaded', async () => {
    try {
        setupEventListeners();
        const playerSlug = new URLSearchParams(window.location.search).get('player');
        if (!playerSlug) throw new Error("No player specified in the URL.");
        const allPlayers = await loadCSV(CSV_URL);
        window.ALL_PLAYERS = allPlayers; // Make players available for search
        const player = allPlayers.find(p => slugOf(p) === playerSlug);
        if (!player) throw new Error("Player not found.");
        initializeProfilePage(player);
    } catch(err) {
        console.error('Initialization failed', err);
        $('#funzone-container').innerHTML = `<p style="color:red; padding:20px;"><strong>Error:</strong> ${err.message}</p>`;
    }
});
</script>
</body>
</html>