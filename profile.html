<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PLAYER PROFILE • Hamilton YAT?STATS</title>

<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400&family=Bebas+Neue&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0c0c0c; --fg:#f2f2f2; --muted:#c4c4c4; --ink:#e8e8e8; --line:rgba(255,255,255,.08);
  --card-bg:#171717; --header-bg:#000; --drawer-bg:rgba(10,10,10,.65);
  --containerPad:16px; --footerH:clamp(56px,8vh,77px);
  --hamSmall:13px; --hamBig:20px; --hamBigger:24px;
}
body.light-theme{
  --bg:#f4f4f4; --fg:#121212; --muted:#555; --ink:#222; --line:rgba(0,0,0,.1);
  --card-bg:#fff; --header-bg:#fff; --drawer-bg:rgba(255,255,255,.65);
}
*{box-sizing:border-box} html,body{margin:0}
body{
  background:var(--bg);color:var(--fg);
  font-family:Oswald,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  transition:background-color .3s,color .3s;
}
a{color:inherit;text-decoration:none}

.container{max-width:1400px;margin:0 auto;padding:0 var(--containerPad)}
.header{position:sticky;top:0;z-index:50;background:var(--header-bg);transition:background-color .3s;}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 0}
.left-icons,.right-icons{display:flex;gap:8px;align-items:center}
.icon-btn{background:none;border:none;color:var(--fg);opacity:.92;display:inline-flex;align-items:center;justify-content:center;padding:0;margin:0 2px;cursor:pointer}
.icon-btn i{font-size:20px}
.topnav{display:flex;gap:18px;align-items:center}
.nav-pair .thin{font:300 var(--hamSmall) Oswald; letter-spacing:.02em; color:#cfd2d6; margin-right:2px}
body.light-theme .nav-pair .thin{color:var(--muted)}
.nav-pair .bold{font:400 var(--hamSmall) "Bebas Neue",sans-serif}
@media (max-width:1200px){ .topnav{display:none !important} }
.hr-y{border-top:1px solid var(--line);transition:border-color .3s;}
.schoolrow{display:flex;align-items:center;gap:16px;padding:6px var(--containerPad)}
.ham-logo{width:auto;height:140px;aspect-ratio:5/7;object-fit:cover;border-radius:10px;background:#000}
.schooltext .small{font:300 var(--hamSmall)/1 Oswald;color:var(--muted);transition:color .3s;}
.schooltext .big1{font:400 var(--hamBig)/1 "Bebas Neue",sans-serif}
.schooltext .big2{font:400 var(--hamBigger)/1 "Bebas Neue",sans-serif;margin-top:-4px}
.crumbs{font:300 calc(var(--hamSmall)*.8)/1 Oswald;color:var(--muted);text-transform:uppercase;white-space:nowrap;transition:color .3s;}

/* Tabs */
.hero{padding:2px 0}
.profile-nav{display:flex;justify-content:space-around;border-bottom:1px solid var(--line);padding:4px 0;transition:border-color .3s;}
.profile-nav-link{background:none;border:none;color:var(--muted);font:700 clamp(10px, 2.5vw, 13px) "Bebas Neue",sans-serif;letter-spacing:.08em;cursor:pointer;padding:8px 10px;border-bottom:2px solid transparent;transition:color .3s;}
.profile-nav-link.active{color:var(--fg);border-bottom-color:var(--fg)}

/* Main */
.main{padding:8px 0 calc(var(--footerH) + 12px)}
#funzone{background:var(--card-bg);border-radius:12px;margin-top:16px;min-height:50vh;color:var(--ink);padding:16px;transition:background-color .3s;}
.stats-header-bar{background:var(--line);color:var(--fg);text-align:center;padding:6px;font:700 12px "Bebas Neue",sans-serif;margin:0 0 12px;border-radius:6px;transition:background-color .3s,color .3s;}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center}
.stat-item{background:var(--line);border-radius:8px;padding:8px 5px;transition:background-color .3s;}
.stat-label{font-size:11px;text-transform:uppercase;opacity:.7;margin-bottom:4px}
.stat-value{font-size:18px;font-weight:700;line-height:1}

/* Simple news list placeholder */
.news-card{display:flex;gap:10px;margin:10px 0;padding:8px;border-radius:10px;border:1px solid var(--line);align-items:center;transition:border-color .3s;}
.news-title{font:700 18px "Bebas Neue",sans-serif;letter-spacing:.03em;line-height:1.1;margin-bottom:4px}
.news-meta{font:300 12px Oswald, sans-serif;opacity:.8}

/* Footer */
.site-footer{position:fixed;left:0;right:0;bottom:0;height:var(--footerH);background:var(--bg);border-top:1px solid var(--line);z-index:40;transition:background-color .3s,border-color .3s;}
.site-footer a{display:block;height:100%;width:100%}
.site-footer img{height:100%;width:100%;object-fit:contain}
</style>
</head>

<body>
<header class="header">
  <div class="container topbar">
    <div class="left-icons">
      <button class="icon-btn" id="btnMenu" aria-label="Menu"><i class="ri-menu-line"></i></button>
      <div id="breadcrumbs" class="crumbs"><a href="index.html">HAMILTON</a> ▸ LOADING…</div>
    </div>
    <nav class="topnav" aria-label="Top Navigation">
      <a href="index.html" class="nav-pair"><span class="thin">WHERE THEY</span><span class="bold">YAT?</span></a>
      <a href="alumni-news.html" class="nav-pair"><span class="thin">ACTIVE ALUMNI</span><span class="bold">NEWS</span></a>
      <a href="all-time-list.html" class="nav-pair"><span class="thin">NEXT-LEVEL</span><span class="bold">ALL-TIME LIST</span></a>
    </nav>
    <div class="right-icons">
      <button class="icon-btn" id="theme-toggle" aria-label="Toggle Theme"><i class="ri-sun-line"></i></button>
      <button class="icon-btn" onclick="history.back()" aria-label="Back"><i class="ri-arrow-left-line"></i></button>
    </div>
  </div>
  <div class="hr-y"></div>
  <div class="container schoolrow">
    <img id="playerLogo" class="ham-logo" src="assets/img/placeholder.png" alt="Player Photo">
    <div class="schooltext">
      <div id="playerTeamOrg" class="small">LOADING PLAYER…</div>
      <div id="playerFirstName" class="big1"></div>
      <div id="playerLastName" class="big2"></div>
    </div>
  </div>
  <div class="hr-y"></div>
  <section class="hero">
    <div class="container">
      <nav id="profileNav" class="profile-nav">
        <button class="profile-nav-link active" data-content="stats">SEASON & CAREER STATISTICS</button>
        <button class="profile-nav-link" data-content="news">NEWS & VIDEO CLIPS</button>
        <button class="profile-nav-link" data-content="social">SOCIAL MEDIA</button>
        <button class="profile-nav-link" data-content="mentor">MENTORSHIP MARKETPLACE</button>
        <button class="profile-nav-link" data-content="gallery">TIMELINE GALLERY</button>
      </nav>
    </div>
  </section>
</header>

<main class="main container">
  <div id="funzone" aria-live="polite">
    <p style="opacity:.8">Loading player data…</p>
  </div>
</main>

<footer class="site-footer">
  <a href="https://www.flowpage.com/petedeluca" target="_blank" rel="noopener noreferrer">
    <img src="assets/img/partners/american_banner.png" alt="Sponsor Banner">
  </a>
</footer>

<script>
/* ---------- CONFIG ---------- */
// Hamilton CSV published from Google Sheets
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQcWJM6Q6hTdFnES_G5LUy4teCS-sJ5HdAc9F5HSY8DGE9egdGy8yUAe2ShT3tFm-CwUuCYeAYy_YiW/pub?gid=2028135390&single=true&output=csv";

/* ---------- HELPERS ---------- */
const $  = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

function clean(v){ return (v || "").toString().trim(); }

function normalizeSlugStr(s){
  return clean(s).toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-+|-+$/g, '');
}

function slugOf(p){
  const raw = clean(p.slug);
  if (raw) return normalizeSlugStr(raw);
  const nm = clean(p.display_name);
  return nm ? normalizeSlugStr(nm) : '';
}

function imageNameOf(p){
  const f = clean(p.first).toLowerCase();
  const l = clean(p.last).toLowerCase();
  const base = (f && l) ? `${f}_${l}` : normalizeSlugStr(p.display_name);
  return base.replace(/[^a-z0-9_]+/g,'');
}

function getParam(name){
  const params = new URLSearchParams(window.location.search);
  const v = params.get(name);
  return v ? decodeURIComponent(v) : "";
}

// Handle AVG/OBP/SLG/OPS formatting
function formatStatValue(key, value){
  if (!value || value === "--") return "--";
  const dec = ["AVG","OBP","SLG","OPS"];
  if (dec.includes(String(key).toUpperCase())){
    const num = parseFloat(value);
    if (isNaN(num)) return value;
    let s = num.toFixed(3);
    if (num > -1 && num < 1) s = s.substring(1); // .345 style
    return s;
  }
  return value;
}

/* CSV loader with simple quoted-comma handling */
async function loadCSV(url){
  const res = await fetch(url, { cache:"no-store" });
  if (!res.ok) throw new Error("CSV load error " + res.status);
  const text = await res.text();
  const lines = text.trim().split(/\r?\n/);
  if (!lines.length) return [];

  // basic CSV split supporting commas in quotes
  const splitCSV = line =>
    line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/)
        .map(c => c.replace(/^"|"$/g,""));

  const header = splitCSV(lines[0]).map(h => h.trim());
  const rows   = lines.slice(1).map(splitCSV);

  const idxOf = (name) => {
    const lower = name.toLowerCase();
    return header.findIndex(h => h.toLowerCase() === lower);
  };

  const statKeys = [
    "avg","obp","slg","ops","ab","h","r","rbi","2b","3b","hr",
    "sb","bb","era","k/9","k/bb","whip","ip","er","ko","gp","w-l","saves","fip"
  ];

  return rows.map((row, i) => {
    const get = (name) => {
      const j = idxOf(name);
      return j >= 0 ? row[j] : "";
    };
    const p = {
      id:         get("id") || String(i+2),
      tbc_id:     get("tbc_id"),
      slug:       get("slug"),
      display_name: get("display_name"),
      first:      get("first"),
      last:       get("last"),
      grad_class: get("grad_class"),
      letter_years:get("letter_years"),
      status:     get("status"),
      level:      get("level"),
      team:       get("team"),
      org:        get("org"),
      position:   get("position"),
      height:     get("height"),
      weight:     get("weight"),
      bats:       get("bats"),
      throws:     get("throws"),
      draft_info: get("Draft_Info") || get("draft_info"),
      colleges:   get("Colleges") || get("colleges"),
      x_handle:   get("x_handle"),
      ig_handle:  get("ig_handle"),
      video_url:  get("video_url"),
      nil_score:  get("nil_score"),
      stats: {}
    };

    statKeys.forEach(k => {
      const v = get(k) || get(k.toUpperCase());
      if (v) p.stats[k.toUpperCase()] = v;
    });

    return p;
  });
}

/* ---------- FIND THE PLAYER ---------- */
function resolvePlayer(players){
  const byParam = getParam("player");
  const byId    = getParam("id");
  const byName  = getParam("name");

  // 1) slug via ?player=slug
  if (byParam){
    const want = normalizeSlugStr(byParam);
    const hit = players.find(p => slugOf(p) === want);
    if (hit) return hit;
  }

  // 2) id via ?id=
  if (byId){
    const want = String(byId).toLowerCase();
    const hit = players.find(p => String(p.id || "").toLowerCase() === want);
    if (hit) return hit;
  }

  // 3) name via ?name=First Last
  if (byName){
    const want = clean(byName).toLowerCase();
    const hit = players.find(p => clean(p.display_name).toLowerCase() === want);
    if (hit) return hit;
  }

  // 4) last chance: query with no key ?cody-bellinger
  if (!byParam && !byId && !byName){
    const q = window.location.search.replace(/^\?/,"");
    if (q && !q.includes("=")){
      const want = normalizeSlugStr(q);
      const hit = players.find(p => slugOf(p) === want);
      if (hit) return hit;
    }
  }

  // fallback: first player so it never stays blank
  return players[0];
}

/* ---------- RENDERERS ---------- */
function statsGrid(p){
  const isPitcher = p.stats["ERA"] !== undefined;
  const bat = ["AVG","OBP","SLG","OPS","H","R","HR","RBI","AB","2B","3B","SB"];
  const pit = ["ERA","K/9","K/BB","WHIP","IP","ER","KO","BB","GP","W-L","SAVES","FIP"];
  const show = isPitcher ? pit : bat;
  const label = (p.status || "").toUpperCase().includes("ACTIVE")
    ? "2025 SEASON STATS"
    : "CAREER STATS";

  return `
    <div class="stats-header-bar">${label}</div>
    <div class="stats-grid">
      ${show.map(s => `
        <div class="stat-item">
          <div class="stat-label">${s}</div>
          <div class="stat-value">${formatStatValue(s, p.stats[s])}</div>
        </div>`).join("")}
    </div>
  `;
}

function newsHTML(p){
  return `
    <div class="stats-header-bar">NEWS & VIDEO CLIPS</div>
    <div id="newsList">
      <div class="news-card">
        <div>
          <div class="news-title">Custom news feed for ${clean(p.display_name)}</div>
          <div class="news-meta">Coming soon – we’ll surface links from your alumni news engine here.</div>
        </div>
      </div>
    </div>
  `;
}

function socialHTML(p){
  const links = [];
  if (p.x_handle) links.push(`<a href="https://x.com/${p.x_handle}" target="_blank" rel="noopener">X / Twitter</a>`);
  if (p.ig_handle) links.push(`<a href="https://instagram.com/${p.ig_handle}" target="_blank" rel="noopener">Instagram</a>`);
  const content = links.length
    ? links.join(" &nbsp;•&nbsp; ")
    : "No social links available yet.";
  return `
    <div class="stats-header-bar">SOCIAL MEDIA</div>
    <p style="padding:12px;">${content}</p>
  `;
}

function mentorHTML(p){
  if (!p.nil_score){
    return `
      <div class="stats-header-bar">MENTORSHIP MARKETPLACE</div>
      <p style="padding:12px;text-align:center;opacity:.8">
        Mentorship is not yet available for ${clean(p.display_name)}.
      </p>
    `;
  }
  return `
    <div class="stats-header-bar">MENTORSHIP MARKETPLACE</div>
    <p style="padding:12px;text-align:center;">
      Upload your baseball video (hitting, throwing, fielding, etc.) and get personalized feedback, coaching,
      and encouragement from ${clean(p.display_name)}!
    </p>
    <button style="width:100%;padding:12px;background:var(--fg);color:var(--bg);border:none;border-radius:8px;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:.08em;cursor:pointer;">
      SEND ${clean(p.first || "").toUpperCase()} A VIDEO
    </button>
  `;
}

function galleryHTML(){
  return `
    <div class="stats-header-bar">TIMELINE GALLERY</div>
    <p style="text-align:center;opacity:.8;padding:12px;">
      Timeline gallery coming soon.
    </p>
  `;
}

function renderTab(p, tab){
  const zone = $("#funzone");
  if (!zone) return;
  switch(tab){
    case "stats":   zone.innerHTML = statsGrid(p); break;
    case "news":    zone.innerHTML = newsHTML(p); break;
    case "social":  zone.innerHTML = socialHTML(p); break;
    case "mentor":  zone.innerHTML = mentorHTML(p); break;
    case "gallery": zone.innerHTML = galleryHTML(); break;
    default:        zone.innerHTML = "<p>Unknown tab.</p>";
  }
}

/* ---------- THEME ---------- */
function setupTheme(){
  const btn  = $("#theme-toggle");
  if (!btn) return;
  const icon = btn.querySelector("i");
  const apply = () => {
    const saved = localStorage.getItem("theme");
    if (saved === "light"){
      document.body.classList.add("light-theme");
      if (icon){ icon.classList.remove("ri-sun-line"); icon.classList.add("ri-moon-line"); }
    } else {
      document.body.classList.remove("light-theme");
      if (icon){ icon.classList.remove("ri-moon-line"); icon.classList.add("ri-sun-line"); }
    }
  };
  btn.addEventListener("click", () => {
    const nowLight = !document.body.classList.contains("light-theme");
    localStorage.setItem("theme", nowLight ? "light" : "dark");
    apply();
  });
  apply();
}

/* ---------- BOOT ---------- */
document.addEventListener("DOMContentLoaded", async () => {
  try {
    setupTheme();

    const funzone = $("#funzone");
    if (funzone) funzone.innerHTML = "<p style='opacity:.8'>Loading player data…</p>";

    const players = await loadCSV(CSV_URL);
    if (!players.length) throw new Error("No rows in CSV");

    const player = resolvePlayer(players);

    // header
    $("#breadcrumbs").innerHTML = `<a href="index.html">HAMILTON</a> ▸ ${clean(player.display_name)}`;
    $("#playerFirstName").textContent = clean(player.first);
    $("#playerLastName").textContent  = clean(player.last);
    $("#playerTeamOrg").textContent   = `${clean(player.team)} • ${clean(player.org)}`;

    const nm = imageNameOf(player);
    const img = $("#playerLogo");
    if (img){
      const jpg = `assets/img/now_players/${nm}.jpg`;
      const png = `assets/img/now_players/${nm}.png`;
      img.src = jpg;
      img.onerror = function(){
        this.onerror = null;
        this.src = png;
      };
    }

    // tabs
    const nav = $("#profileNav");
    if (nav){
      nav.addEventListener("click", (e) => {
        const btn = e.target.closest(".profile-nav-link");
        if (!btn) return;
        $$(".profile-nav-link").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        renderTab(player, btn.dataset.content);
      });
    }

    // initial tab (stats by default)
    const tabParam = (getParam("tab") || "stats").toLowerCase();
    const valid = ["stats","news","social","mentor","gallery"];
    const currentTab = valid.includes(tabParam) ? tabParam : "stats";
    renderTab(player, currentTab);
    $$(".profile-nav-link").forEach(b => {
      b.classList.toggle("active", b.dataset.content === currentTab);
    });

  } catch (err) {
    console.error(err);
    const funzone = $("#funzone");
    if (funzone){
      funzone.innerHTML = `<p style="color:#f88">Failed to load profile. ${err.message}</p>`;
    }
  }
});
</script>
</body>
</html>