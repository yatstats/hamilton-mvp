<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hamilton Active Baseball Alumni • Player Profile</title>

  <!-- ICONS & FONTS -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500&family=Bebas+Neue&display=swap" rel="stylesheet">

  <style>
  :root{
    --bg:#0c0c0c; --fg:#f2f2f2; --muted:#c4c4c4; --ink:#e8e8e8; --line:rgba(255,255,255,.08);
    --card-bg:#171717; --header-bg:#000;
    --hamSmall:13px; --hamBig:20px; --hamBigger:24px; --tagGrey:#cfd2d6;
    --crestH:clamp(42px,6.3vw,74px);
    --containerPad:16px;
    --footerH:clamp(56px,8vh,77px);
  }
  body.light-theme{
    --bg:#f4f4f4; --fg:#121212; --muted:#555; --ink:#222; --line:rgba(0,0,0,.1);
    --card-bg:#fff; --header-bg:#fff;
  }
  @font-face{
    font-family:'Indigo';
    src:url('assets/fonts/Indigo.otf') format('opentype');
    font-weight:400;
    font-style:normal;
    font-display:swap;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    background:var(--bg);
    color:var(--fg);
    font-family:Oswald,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    transition:background-color .3s,color .3s;
  }
  a{color:inherit;text-decoration:none}
  .container{max-width:1400px;margin:0 auto;padding:0 var(--containerPad)}

  /* ===== GLOBAL HEADER (same as index) ===== */
  .header{
    position:sticky;
    top:0;
    z-index:40;
    background:var(--header-bg);
    transition:background-color .3s;
  }
  .topbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:8px 0;
  }
  .left-icons{
    display:flex;
    align-items:center;
    gap:8px;
  }
  .icon-btn{
    background:none;
    border:none;
    color:var(--fg);
    opacity:.92;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:4px;
    margin:0 2px;
    cursor:pointer;
  }
  .icon-btn i{font-size:20px}
  /* nudge the hamburger right to line up with logo/hero */
  #btnMenu{margin-left:2px;}

  .topnav{
    display:flex;
    gap:18px;
    align-items:center;
  }
  .nav-pair{white-space:nowrap}
  .nav-pair .thin{
    font:300 var(--hamSmall) Oswald,sans-serif;
    letter-spacing:.02em;
    color:#cfd2d6;
    margin-right:2px;
  }
  body.light-theme .nav-pair .thin{color:var(--muted);}
  .nav-pair .bold{
    font:400 var(--hamSmall) Indigo,"Bebas Neue",sans-serif;
  }
  .wordmark-wrap{
    display:flex;
    align-items:center;
    justify-content:flex-end;
    min-width:120px;
  }
  .wordmark-img{
    height:clamp(18px,3.2vw,28px);
    width:auto;
    display:block;
  }
  body.light-theme .wordmark-img{filter:invert(1);}
  @media (max-width:1200px){
    .topnav{display:none !important;}
  }

  .hr-y{border-top:1px solid var(--line);}

  .schoolrow{
    display:flex;
    align-items:center;
    gap:12px;
    padding:6px var(--containerPad);
  }
  .ham-logo{
    height:var(--crestH);
    width:auto;
    object-fit:contain;
    display:block;
    flex-shrink:0;
  }
  .schooltext{line-height:1}
  .schooltext .small{
    font:300 var(--hamSmall)/1 Oswald;
    letter-spacing:.12em;
    color:var(--muted);
  }
  .schooltext .big1{
    font:400 var(--hamBig)/1 "Bebas Neue",sans-serif;
    letter-spacing:.09em;
  }
  .schooltext .big2{
    font:400 var(--hamBigger)/1 "Bebas Neue",sans-serif;
    letter-spacing:.09em;
    margin-top:-2px;
  }

  /* HERO ROW (breadcrumbs + CTA + search) */
  .hero{
    padding:4px 0 6px;
    background:var(--header-bg);
  }
  .hero-grid{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .hero-left{
    display:flex;
    flex-direction:column;
    gap:2px;
  }
  .crumbs{
    font:300 calc(var(--hamSmall)*.7)/1 Oswald;
    letter-spacing:.08em;
    text-transform:uppercase;
    color:var(--muted);
  }
  .cta-line{
    font-family:Oswald,sans-serif;
    font-size:12px;
    letter-spacing:.18em;
    text-transform:uppercase;
    white-space:nowrap;
  }
  .cta-line span.bold{
    font-family:Indigo,"Bebas Neue",sans-serif;
    letter-spacing:.12em;
  }
  .hero-right{
    display:flex;
    gap:10px;
    align-items:center;
  }

  /* MAIN LAYOUT */
  main{
    padding:12px 0 calc(var(--footerH) + 12px);
  }
  .profile-shell{
    max-width:1200px;
    margin:0 auto;
    padding:0 var(--containerPad);
  }
  .profile-card{
    background:var(--card-bg);
    border-radius:22px;
    box-shadow:0 8px 24px rgba(0,0,0,.4);
    padding:18px 18px 24px;
  }

  .player-header{
    display:flex;
    gap:18px;
    align-items:flex-start;
    margin-bottom:18px;
    transition:padding .25s, box-shadow .25s, border-radius .25s;
  }
  .player-photo-wrap{
    flex-shrink:0;
    border-radius:18px;
    overflow:hidden;
    box-shadow:0 4px 12px rgba(0,0,0,.5);
  }
  .player-photo{
    display:block;
    width:min(260px,72vw);
    height:auto;
  }

  .player-meta{
    flex:1;
  }
  .player-team{
    font:400 13px/1.3 Oswald,sans-serif;
    letter-spacing:.18em;
    text-transform:uppercase;
    color:var(--muted);
    margin-bottom:4px;
  }
  .player-name{
    font:400 clamp(26px,4.2vw,34px) "Bebas Neue",sans-serif;
    letter-spacing:.12em;
  }
  .player-line2{
    margin-top:4px;
    font:300 13px/1.4 Oswald;
    letter-spacing:.12em;
    text-transform:uppercase;
    color:var(--muted);
  }
  .player-line2 span{white-space:nowrap;}

  .bio-lines{
    margin-top:10px;
    font-size:13px;
    line-height:1.5;
  }
  .bio-lines strong{font-weight:500;}

  /* FUNZONE TABS */
  .funzone-shell{
    margin-top:18px;
  }
  .funzone-tabs{
    display:flex;
    flex-wrap:wrap;
    border-bottom:1px solid var(--line);
    position:sticky;
    top:134px; /* just under global header on mobile */
    z-index:30;
    background:var(--card-bg);
  }
  @media (min-width:900px){
    .funzone-tabs{top:140px;}
  }
  .fun-tab{
    flex:1 1 50%;
    text-align:center;
    padding:10px 6px;
    border:none;
    background:none;
    cursor:pointer;
    font:700 11px "Bebas Neue",sans-serif;
    letter-spacing:.12em;
    text-transform:uppercase;
    color:var(--muted);
    border-bottom:2px solid transparent;
  }
  .fun-tab.active{
    color:var(--fg);
    border-bottom-color:var(--fg);
  }
  .funzone-panel{
    display:none;
    padding:14px 4px 4px;
  }
  .funzone-panel.active{display:block;}

  /* STATS GRID */
  .stats-section-title{
    background:var(--line);
    padding:6px 10px;
    border-radius:10px;
    font:700 12px "Bebas Neue",sans-serif;
    letter-spacing:.18em;
    text-align:center;
    text-transform:uppercase;
    margin:6px 0 10px;
  }
  .stats-grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:8px;
    margin-bottom:14px;
  }
  .stat-item{
    text-align:center;
    background:var(--line);
    border-radius:10px;
    padding:8px 5px;
  }
  .stat-label{
    font-size:10px;
    text-transform:uppercase;
    opacity:.7;
  }
  .stat-value{
    margin-top:4px;
    font-size:16px;
    font-weight:600;
  }
  @media (max-width:640px){
    .stats-grid{grid-template-columns:repeat(3,1fr);}
  }

  /* NEWS CARDS */
  .news-card{
    display:flex;
    gap:10px;
    padding:10px;
    margin-bottom:10px;
    border-radius:12px;
    border:1px solid var(--line);
    background:rgba(0,0,0,.1);
  }
  body.light-theme .news-card{
    background:rgba(255,255,255,.7);
  }
  .news-thumb{
    flex-shrink:0;
    width:84px;
    height:64px;
    border-radius:8px;
    background-size:cover;
    background-position:center;
  }
  .news-title{
    font-weight:600;
    margin-bottom:4px;
    line-height:1.2;
  }
  .news-meta{
    font-size:11px;
    opacity:.7;
    margin-bottom:4px;
  }
  .news-recap{
    font-size:12px;
    line-height:1.4;
  }

  /* SOCIAL LIST */
  .social-list{
    list-style:none;
  }
  .social-list li{
    margin-bottom:10px;
  }
  .social-list a{
    text-decoration:underline;
    text-underline-offset:2px;
  }

  /* MENTORSHIP */
  .mm-box{
    border-radius:12px;
    border:1px solid var(--line);
    padding:12px;
    margin-bottom:16px;
  }
  .mm-box h4{
    font:700 14px "Bebas Neue",sans-serif;
    letter-spacing:.14em;
    margin-bottom:4px;
  }
  .mm-box p{font-size:13px;line-height:1.4;}

  .mm-cta-btn{
    margin-top:10px;
    width:100%;
    padding:11px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    font:700 12px "Bebas Neue",sans-serif;
    letter-spacing:.18em;
    text-transform:uppercase;
    background:var(--fg);
    color:var(--bg);
  }

  /* GALLERY */
  .gallery-strip{
    display:flex;
    gap:10px;
    overflow-x:auto;
    padding-bottom:6px;
  }
  .gallery-strip img{
    height:120px;
    border-radius:10px;
    flex-shrink:0;
    object-fit:cover;
  }

  /* COMPACT HEADER (on scroll, all tabs) */
  .profile-shell.compact .profile-card{
    border-radius:0 0 22px 22px;
  }
  .profile-shell.compact .player-header{
    position:sticky;
    top:96px; /* just under main header on mobile */
    z-index:32;
    padding-bottom:8px;
    background:var(--card-bg);
  }
  @media (min-width:900px){
    .profile-shell.compact .player-header{top:100px;}
  }
  .profile-shell.compact .player-header{
    align-items:center;
    gap:10px;
  }
  .profile-shell.compact .player-photo{
    width:90px;
  }
  .profile-shell.compact .player-photo-wrap{
    border-radius:12px;
    box-shadow:0 3px 8px rgba(0,0,0,.5);
  }
  .profile-shell.compact .player-name{
    font-size:22px;
  }
  .profile-shell.compact .bio-lines{
    display:none;
  }

  /* MOBILE TWEAKS */
  @media (max-width:768px){
    .player-header{
      flex-direction:column;
      align-items:flex-start;
    }
    .profile-shell.compact .player-header{
      flex-direction:row;
    }
    .player-photo{
      width:min(220px,80vw);
    }
  }

  /* FOOTER */
  .site-footer{
    position:fixed;
    left:0;right:0;bottom:0;
    height:var(--footerH);
    border-top:1px solid var(--line);
    background:var(--bg);
    z-index:20;
  }
  .site-footer img{
    height:100%;
    width:100%;
    object-fit:contain;
  }

  /* ACCESSIBILITY */
  .icon-btn:focus,button:focus{outline:2px solid var(--fg);outline-offset:2px;}
  </style>
</head>
<body>
<header class="header">
  <div class="container topbar">
    <div class="left-icons">
      <button class="icon-btn" id="btnMenu" aria-label="Menu">
        <i class="ri-menu-line"></i>
      </button>
      <button class="icon-btn" id="btnAccount" aria-label="Account">
        <i class="ri-user-3-line"></i>
      </button>
      <button class="icon-btn" id="theme-toggle" aria-label="Toggle Theme">
        <i class="ri-sun-line"></i>
      </button>
    </div>

    <nav class="topnav" aria-label="Top Navigation">
      <a href="index.html" class="nav-pair"><span class="thin">WHERE THEY</span><span class="bold">YAT?</span></a>
      <a href="alumni-news.html" class="nav-pair"><span class="thin">ACTIVE ALUMNI</span><span class="bold">NEWS</span></a>
      <a href="current-team.html" class="nav-pair"><span class="thin">THE</span><span class="bold">CURRENT TEAM</span></a>
      <a href="marketplace.html" class="nav-pair"><span class="thin">MENTORSHIP</span><span class="bold">MARKETPLACE</span></a>
      <a href="all-time-list.html" class="nav-pair"><span class="thin">NEXT-LEVEL</span><span class="bold">ALL-TIME LIST</span></a>
      <a href="partner-program.html" class="nav-pair"><span class="thin">PCD ACTION</span><span class="bold">PARTNER PROGRAM</span></a>
      <a href="faq.html" class="nav-pair"><span class="bold">FAQ’S</span></a>
    </nav>

    <div class="wordmark-wrap">
      <img src="assets/img/yatstats-logo.png" class="wordmark-img" alt="YAT?STATS">
    </div>
  </div>

  <div class="hr-y"></div>

  <div class="container schoolrow">
    <img class="ham-logo" src="assets/img/schools/hamilton.az.png" alt="Hamilton H">
    <div class="schooltext">
      <div class="small">CHANDLER, AZ</div>
      <div class="big1">HAMILTON HIGH SCHOOL</div>
      <div class="big2">ACTIVE BASEBALL ALUMNI</div>
    </div>
  </div>

  <div class="hr-y"></div>

  <section class="hero">
    <div class="container hero-grid">
      <div class="hero-left">
        <div class="crumbs" id="crumbs">HAMILTON ▸ PLAYER</div>
        <div class="cta-line" id="superfanCta">
          ADD <span class="bold" id="ctaName">PLAYER NAME</span> TO MY SUPERFAN DASHBOARD
        </div>
      </div>
      <div class="hero-right">
        <!-- Favorite star next to breadcrumbs/CTA instead of on card -->
        <button class="icon-btn" id="favoriteBtn" aria-label="Favorite player">
          <i class="ri-star-line" id="favoriteIcon"></i>
        </button>
        <button class="icon-btn" id="profileSearchBtn" aria-label="Search players">
          <i class="ri-search-line"></i>
        </button>
      </div>
    </div>
  </section>
</header>

<main>
  <div class="profile-shell" id="profileShell">
    <div class="profile-card" id="profileCard">
      <!-- PLAYER HEADER (image + bio) -->
      <section class="player-header" id="playerHeader">
        <div class="player-photo-wrap">
          <img src="" alt="" class="player-photo" id="playerPhoto">
        </div>
        <div class="player-meta">
          <div class="player-team" id="playerTeam">TEAM • LEVEL</div>
          <div class="player-name" id="playerName">PLAYER NAME</div>
          <div class="player-line2" id="playerLine2">
            <span id="playerStatus">TRIPLE-A • ACTIVE 2025</span>
          </div>
          <div class="bio-lines" id="bioLines">
            <div><strong>Draft:</strong> <span id="draftInfo">N/A</span></div>
            <div><strong>Colleges:</strong> <span id="colleges">N/A</span></div>
            <div><strong>Profile:</strong> <span id="bodyLine">SS | H: 6-0 | W: 180 | B/T: R/R</span></div>
          </div>
        </div>
      </section>

      <!-- FUNZONE -->
      <section class="funzone-shell">
        <div class="funzone-tabs" id="funTabs">
          <button class="fun-tab active" data-panel="statsPanel">Season & Career Statistics</button>
          <button class="fun-tab" data-panel="newsPanel">News & Video Clips</button>
          <button class="fun-tab" data-panel="socialPanel">Social Media</button>
          <button class="fun-tab" data-panel="mentorPanel">Mentorship Marketplace</button>
          <button class="fun-tab" data-panel="galleryPanel">Timeline Gallery</button>
        </div>

        <!-- STATS -->
        <div class="funzone-panel active" id="statsPanel">
          <div id="statsContent">
            <div class="stats-section-title">CAREER STATS</div>
            <div class="stats-grid" id="careerStatsGrid"></div>

            <div class="stats-section-title">2025 SEASON STATS</div>
            <div class="stats-grid" id="season2025Grid"></div>

            <div class="stats-section-title">2024 SEASON STATS</div>
            <div class="stats-grid" id="season2024Grid"></div>

            <div class="stats-section-title">2023 SEASON STATS</div>
            <div class="stats-grid" id="season2023Grid"></div>
          </div>
        </div>

        <!-- NEWS -->
        <div class="funzone-panel" id="newsPanel">
          <div class="stats-section-title">LATEST HEADLINES</div>
          <div id="newsList">
            <!-- Sample card; real ones can replace via script -->
            <article class="news-card">
              <div class="news-thumb" style="background-image:url('assets/img/hs_players/drew_swift.jpg');"></div>
              <div>
                <div class="news-title">Drew Swift multi-hit night for Aviators</div>
                <div class="news-meta">MiLB • 8/25/2025 • Via milb.com</div>
                <div class="news-recap">
                  Swifty was piling up multi-hit games back in his Hamilton Huskies days, and he’s still at it in Triple-A for the Aviators. YAT-A-BOY, Drew — Huskies nation sees you!
                </div>
              </div>
            </article>
          </div>
        </div>

        <!-- SOCIAL -->
        <div class="funzone-panel" id="socialPanel">
          <div class="stats-section-title">LATEST SOCIAL POSTS</div>
          <ul class="social-list" id="socialList">
            <li id="socialXRow">X / Twitter: <a href="#" target="_blank" rel="noopener" id="xLink">@player</a></li>
            <li id="socialIGRow">Instagram: <a href="#" target="_blank" rel="noopener" id="igLink">@player</a></li>
          </ul>
          <p style="font-size:12px;opacity:.7;margin-top:8px;">
            Share your favorite highlights with <strong>#YAT-A-BOY</strong> and tag <strong>@yat_stats</strong> to help boost your guy’s NIL value.
          </p>
        </div>

        <!-- MENTORSHIP -->
        <div class="funzone-panel" id="mentorPanel">
          <div class="stats-section-title">MENTORSHIP MARKETPLACE</div>
          <div class="mm-box">
            <h4>PERSONALIZED VIDEO BREAKDOWN</h4>
            <p>
              Upload a clip of your swing, throwing mechanics, or fielding and get a personalized breakdown from this player.
              You’ll get timestamped feedback, drills to work on, and a YAT-A-BOY shout-out you can keep forever.
            </p>
            <button class="mm-cta-btn">START A MENTORSHIP REQUEST</button>
          </div>
          <p style="font-size:12px;opacity:.7;">
            The purchase flow (Add to Cart / Buy Now) will live in the Mentorship Marketplace funnel and your SuperFan dashboard.
            This tab gives each player their own storefront window into that experience.
          </p>
        </div>

        <!-- GALLERY -->
        <div class="funzone-panel" id="galleryPanel">
          <div class="stats-section-title">TIMELINE GALLERY</div>
          <p style="font-size:13px;margin-bottom:8px;">
            We’ll be inviting family, friends, teammates, and fans to submit photos from Little League to today.
            Once approved, they’ll appear here in order so you can swipe through this player’s journey.
          </p>
          <div class="gallery-strip" id="galleryStrip">
            <img src="assets/img/hs_players/drew_swift.jpg" alt="High school days">
            <img src="assets/img/now_players/drew_swift.jpg" alt="Pro ball">
            <img src="assets/img/hs_players/drew_swift.jpg" alt="Throwback">
          </div>
        </div>
      </section>
    </div>
  </div>
</main>

<footer class="site-footer">
  <a href="https://www.flowpage.com/petedeluca" target="_blank" rel="noopener noreferrer">
    <img src="assets/img/partners/american_banner.png" alt="American Solutions for Business">
  </a>
</footer>

<script>
/* ========= SMALL HELPER UTILS ========= */
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQcWJM6Q6hTdFnES_G5LUy4teCS-sJ5HdAc9F5HSY8DGE9egdGy8yUAe2ShT3tFm-CwUuCYeAYy_YiW/pub?gid=2028135390&output=csv";

const $ = s => document.querySelector(s);
const params = new URLSearchParams(location.search);
const requestedSlug = params.get('player') || '';

function slugOf(player){
  if (!player) return '';
  const s = (player.slug || '').trim();
  if (s) return s;
  return (player.display_name || '')
    .trim()
    .toLowerCase()
    .replace(/[^a-z0-9]+/g,'-');
}
function imageNameOf(p){
  const first = (p.first||'').toLowerCase().replace(/\s+/g,'_');
  const last  = (p.last||'').toLowerCase().replace(/\s+/g,'_');
  if (first || last) return [first,last].filter(Boolean).join('_');
  return (p.slug || p.display_name || '').toLowerCase().replace(/\s+/g,'_').replace(/[^a-z0-9_]/g,'');
}
function formatDecimalStat(key, val){
  if (!val || val === '--') return '--';
  const decimals = ['AVG','OBP','SLG','OPS'];
  if (!decimals.includes(key)) return val;
  const num = parseFloat(val);
  if (Number.isNaN(num)) return val;
  const s = num.toFixed(3);
  return (num < 1 && num > -1) ? s.substring(1) : s;
}

/* ========= THEME SYNC ========= */
(function setupTheme(){
  const toggle = $('#theme-toggle');
  const icon   = toggle.querySelector('i');
  const saved = localStorage.getItem('theme');
  if (saved === 'light') {
    document.body.classList.add('light-theme');
    icon.classList.remove('ri-sun-line');
    icon.classList.add('ri-moon-line');
  }
  toggle.addEventListener('click', () => {
    document.body.classList.toggle('light-theme');
    const isLight = document.body.classList.contains('light-theme');
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
    if (isLight){
      icon.classList.remove('ri-sun-line');
      icon.classList.add('ri-moon-line');
    }else{
      icon.classList.remove('ri-moon-line');
      icon.classList.add('ri-sun-line');
    }
  });
})();

/* ========= FUNZONE TABS (all share same sticky behavior) ========= */
(function setupTabs(){
  const tabs = document.querySelectorAll('.fun-tab');
  const panels = document.querySelectorAll('.funzone-panel');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const id = tab.dataset.panel;
      tabs.forEach(t => t.classList.remove('active'));
      panels.forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(id).classList.add('active');
      // scrolling behavior: make sure sticky header works regardless of tab
      // (no special-casing the stats tab)
    });
  });
})();

/* ========= COMPACT HEADER ON SCROLL (applies to ALL tabs) ========= */
(function setupCompactHeader(){
  const shell = $('#profileShell');
  const triggerY = 220; // px down before we compact
  window.addEventListener('scroll', () => {
    if (window.scrollY > triggerY){
      shell.classList.add('compact');
    }else{
      shell.classList.remove('compact');
    }
  });
})();

/* ========= FAVORITE STAR + CTA CLICK ========= */
(function setupFavoriteAndCTA(){
  const icon = $('#favoriteIcon');
  const btn  = $('#favoriteBtn');
  const cta  = $('#superfanCta');

  function toggleStar(){
    const filled = icon.classList.contains('ri-star-fill');
    if (filled){
      icon.classList.remove('ri-star-fill');
      icon.classList.add('ri-star-line');
    }else{
      icon.classList.add('ri-star-fill');
      icon.classList.remove('ri-star-line');
    }
  }

  btn.addEventListener('click', toggleStar);
  cta.addEventListener('click', () => {
    // placeholder purchase pop-up
    alert("This will be your SuperFan subscription pop-up: price, Add to Cart, or Buy Now.");
  });
})();

/* ========= CSV LOAD + PAGE BINDING ========= */
async function loadCSV(url){
  const res = await fetch(url);
  const text = await res.text();
  const rows = text.trim().split(/\r?\n/).map(line =>
    line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,""))
  );
  const header = rows.shift().map(h => h.trim());
  const idx = name => header.indexOf(name);

  const statKeys = [
    'avg','obp','slg','ops',
    'ab','h','r','rbi','2b','3b','hr','sb',
    'bb','era','k/9','k/bb','whip','ip','er','ko','gp','w-l','saves','fip'
  ];

  return rows.map(r=>{
    const p = {
      slug:r[idx('slug')],
      display_name:r[idx('display_name')],
      first:r[idx('first')],
      last:r[idx('last')],
      grad_class:r[idx('grad_class')],
      letter_years:r[idx('letter_years')],
      status:r[idx('status')],
      level:r[idx('level')],
      team:r[idx('team')],
      org:r[idx('org')],
      position:r[idx('position')],
      height:r[idx('height')],
      weight:r[idx('weight')],
      bats:r[idx('bats')],
      throws:r[idx('throws')],
      draft_info:r[idx('Draft_Info')] ?? r[idx('draft_info')],
      colleges:r[idx('Colleges')] ?? r[idx('colleges')],
      x_handle:r[idx('x_handle')],
      ig_handle:r[idx('ig_handle')],
      stats:{}
    };
    statKeys.forEach(key=>{
      const i = idx(key);
      if (i>-1 && r[i]) p.stats[key.toUpperCase()] = r[i];
    });
    return p;
  });
}

function buildStatsGrid(player, targetId){
  const holder = document.getElementById(targetId);
  if (!holder) return;
  holder.innerHTML = '';
  const isPitcher = player.stats['ERA'] !== undefined;
  const batterStats = ['AVG','OBP','SLG','OPS','H','R','HR','RBI','AB','2B','3B','SB'];
  const pitcherStats = ['ERA','K/9','K/BB','WHIP','IP','ER','KO','BB','GP','W-L','SAVES','FIP'];
  const keys = isPitcher ? pitcherStats : batterStats;
  keys.forEach(k=>{
    const v = formatDecimalStat(k, player.stats[k] || '--');
    const div = document.createElement('div');
    div.className = 'stat-item';
    div.innerHTML = `<div class="stat-label">${k}</div><div class="stat-value">${v}</div>`;
    holder.appendChild(div);
  });
}

(async function initProfile(){
  try{
    const players = await loadCSV(CSV_URL);
    let player = players.find(p => slugOf(p) === requestedSlug);
    if (!player){
      // fallback: use display_name match
      player = players.find(p => (p.display_name||'').toLowerCase() === requestedSlug.replace(/-/g,' '));
    }
    if (!player){
      $('#playerName').textContent = 'Player not found';
      return;
    }

    // Fill header + hero
    const name = player.display_name || `${player.first||''} ${player.last||''}`.trim();
    $('#playerName').textContent = name;
    $('#ctaName').textContent = name.toUpperCase();
    $('#crumbs').textContent = `HAMILTON ▸ ${name}`;
    $('#playerTeam').textContent = `${player.team || ''} • ${player.org || player.level || ''}`;
    $('#playerStatus').textContent = `${player.level || ''} • ${player.status || ''}`;
    $('#draftInfo').textContent = player.draft_info || 'N/A';
    $('#colleges').textContent = player.colleges || 'N/A';
    $('#bodyLine').textContent =
      `${player.position || '--'} | H: ${player.height||'--'} | W: ${player.weight||'--'} | B/T: ${player.bats||'--'}/${player.throws||'--'}`;

    // Image
    const imgName = imageNameOf(player);
    const nowJpg = `assets/img/now_players/${imgName}.jpg`;
    const nowPng = `assets/img/now_players/${imgName}.png`;
    const photo = $('#playerPhoto');
    photo.src = nowJpg;
    photo.alt = name;
    photo.onerror = () => {
      if (photo.src.endsWith('.jpg')) photo.src = nowPng;
    };

    // Social
    if (player.x_handle){
      $('#xLink').href = `https://x.com/${player.x_handle}`;
      $('#xLink').textContent = '@' + player.x_handle;
    }else{
      $('#socialXRow').style.display = 'none';
    }
    if (player.ig_handle){
      $('#igLink').href = `https://instagram.com/${player.ig_handle}`;
      $('#igLink').textContent = '@' + player.ig_handle;
    }else{
      $('#socialIGRow').style.display = 'none';
    }

    // Stats grids – reuse same numbers for now for demo
    buildStatsGrid(player, 'careerStatsGrid');
    buildStatsGrid(player, 'season2025Grid');
    buildStatsGrid(player, 'season2024Grid');
    buildStatsGrid(player, 'season2023Grid');
  }catch(err){
    console.error(err);
  }
})();
</script>
</body>
</html>