<section id="search-section" class="py-20 bg-brand-navy text-white">
  <div class="container mx-auto px-6 text-center">
    <h2 class="text-4xl font-bold mb-4">Search the Database</h2>
    <p class="text-brand-silver max-w-2xl mx-auto mb-10">
      Enter a high school name, city, or state to see their alumni stats and microsite status.
    </p>

    <div class="max-w-2xl mx-auto">
      <div class="flex flex-col sm:flex-row gap-4 mb-6">
        <input type="text" id="school-search-input"
               class="w-full flex-grow bg-brand-steel border-2 border-brand-steel text-white placeholder-brand-silver text-lg rounded-md p-4 focus:outline-none focus:ring-2 focus:ring-brand-red"
               placeholder="E.g., Hamilton High School">
        <button id="search-button"
                class="bg-brand-red text-white font-bold py-4 px-8 rounded-md text-lg hover:bg-red-700 transition">
          Search
        </button>
      </div>
    </div>

    <div id="results-container"
         class="mt-8 bg-brand-blue rounded-lg p-8 max-w-3xl mx-auto text-left hidden">
      <div id="results-content"></div>
    </div>
  </div>
</section>

<script>
  const SHEET_URL = "https://opensheet.elk.sh/1yUNQH9NbpKwOOwH9blf5ZqQfmft796sQl1dqghXP4uA/HS_Baseball_Programs";
  let rows = [];

  async function loadData() {
    const res = await fetch(SHEET_URL);
    rows = await res.json();
  }

  function searchSchools(query) {
    query = query.trim().toLowerCase();
    const container = document.getElementById("results-container");
    const content = document.getElementById("results-content");
    content.innerHTML = "";
    container.classList.remove("hidden");

    if (!query) {
      content.innerHTML = "<p class='text-brand-silver'>Please enter a school name, city, or state.</p>";
      return;
    }

    const matches = rows.filter(r =>
      (r.hsname && r.hsname.toLowerCase().includes(query)) ||
      (r.city && r.city.toLowerCase().includes(query)) ||
      (r.regionname && r.regionname.toLowerCase().includes(query))
    );

    if (matches.length === 0) {
      content.innerHTML = "<p class='text-brand-silver'>No matches found.</p>";
      return;
    }

    matches.slice(0, 10).forEach(school => {
      const activeAlumni = parseInt(school["Active Alumni"] || 0, 10);
      let message = "";
      let actionHTML = "";

      if (activeAlumni <= 13) {
        message = `
          <p class="mt-2 text-yellow-400">
            We Found Your High School. Unfortunately, due to limited Active Alumni, 
            they did not qualify for their own YATSTATS Microsite.
          </p>
          <p class="mt-2">Join our mailing list to access 40,000+ Active Alumni nationwide.</p>
        `;
        actionHTML = `<button class="mt-3 bg-brand-red text-white px-4 py-2 rounded">Join Mailing List</button>`;
      } else {
        // Here‚Äôs where you‚Äôll eventually check if a microsite exists
        const micrositeExists = false; // Replace with real logic
        if (micrositeExists) {
          message = `<p class="mt-2 text-green-400">We Found Your High School! Click below to track their alumni.</p>`;
          actionHTML = `<a href="https://${school.hsname.replace(/\s+/g, '').toLowerCase()}.yatstats.com" 
                          class="mt-3 inline-block bg-brand-red text-white px-4 py-2 rounded">Visit Microsite</a>`;
        } else {
          message = `
            <p class="mt-2 text-green-400">
              We Found Your High School and Good News! Due to this program's high Active Alumni count, 
              they will soon have their own YATSTATS Microsite.
            </p>
            <p class="mt-2">Join our mailing list and share a possible sponsor to expedite the process.</p>
          `;
          actionHTML = `<button class="mt-3 bg-brand-red text-white px-4 py-2 rounded">Join + Share Sponsor</button>`;
        }
      }

      const card = `
        <div class="p-4 mb-4 bg-brand-navy border border-brand-silver rounded shadow">
          <h3 class="text-xl font-bold">${school.hsname} <span class="text-brand-silver">(${school.regionname || ""})</span></h3>
          <p class="text-brand-silver">üèÖ Rank: ${school["YATSTATS National Ranking"] || "N/A"}</p>
          <p class="text-brand-silver">üìç ${school.city || ""}</p>
          <p class="text-brand-silver">Nickname: ${school.nickname || "-"}</p>
          <p class="text-brand-silver">Alumni Listed: ${school["alumni listed"]}</p>
          <p class="text-brand-silver">Drafted from School: ${school["Drafted from School"]}</p>
          <p class="text-brand-silver">Total Draft Picks: ${school["Total Draft Picks"]}</p>
          <p class="text-brand-silver">Major Leaguers: ${school["Major Leaguers"]}</p>
          <p class="text-brand-silver">Active Alumni: ${activeAlumni}</p>
          ${message}
          ${actionHTML}
        </div>
      `;
      content.innerHTML += card;
    });
  }

  document.getElementById("search-button").addEventListener("click", () => {
    const val = document.getElementById("school-search-input").value;
    searchSchools(val);
  });

  loadData();
</script>