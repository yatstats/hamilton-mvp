<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Where They YAT? • Hamilton YATSTATS</title>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400&family=Bebas+Neue&display=swap" rel="stylesheet">

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    
    window.firebaseAuth = { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously };

    try {
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        
        onAuthStateChanged(window.auth, user => {
            const event = new CustomEvent('authStateChanged', { detail: { user } });
            document.dispatchEvent(event);
        });

        if (window.__initial_auth_token) {
            await signInWithEmailAndPassword(window.auth, window.__initial_auth_token);
        } else {
            await signInAnonymously(window.auth);
        }
    } catch (e) {
        console.error("Firebase initialization error:", e);
    }
</script>

<style>
/* All CSS is now embedded in this file */
:root{
  --bg:#0c0c0c; --fg:#f2f2f2; --muted:#c4c4c4; --ink:#e8e8e8; --line:rgba(255,255,255,0.08);
  --hamSmall:13px; --hamBig:20px; --hamBigger:24px; --tagGrey:#cfd2d6;
  --crestH: clamp(40px, 6vw, 60px);
  --pairGap: 10px;
  --containerPad: 16px;
  --footerH: clamp(56px, 8vh, 77px);
}
@font-face{ font-family:'Indigo'; src:url('assets/fonts/Indigo.otf') format('opentype'); font-weight:400; font-style:normal; font-display:swap; }
*{box-sizing:border-box} html,body{margin:0}
body{background:var(--bg);color:var(--fg);font-family:Oswald,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
body.drawer-open { overflow: hidden; }
a{color:inherit;text-decoration:none}
.container{max-width:1400px;margin:0 auto;padding:0 var(--containerPad)}
.header{position:sticky;top:0;z-index:50;background:#000}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 0}
.left-icons{display:flex;align-items:center;gap:8px}
.icon-btn{background:none;border:none;color:var(--fg);opacity:.92;display:inline-flex;align-items:center;justify-content:center;padding:0;margin:0 2px; cursor: pointer;}
.icon-btn i{font-size:20px}
.topnav{display:flex;gap:18px;align-items:center}
.nav-pair{white-space:nowrap}
.nav-pair .thin{font:300 var(--hamSmall) Oswald, sans-serif; letter-spacing:.02em; color:#cfd2d6; margin-right:2px}
.nav-pair .bold{font:400 var(--hamSmall) Indigo, "Bebas Neue", sans-serif}
.wordmark-wrap{display:flex;align-items:center;justify-content:flex-end;min-width:120px}
.wordmark-img{height:clamp(18px,3.2vw,28px);width:auto;display:block}
@media (max-width:1200px){ .topnav{display:none !important} }
.hr-y{border-top:1px solid var(--line)}
.schoolrow{display:flex;align-items:center;gap:var(--pairGap);padding:6px 0}
.ham-logo{height:var(--crestH);width:auto;object-fit:contain;display:block; flex-shrink: 0;}
.schooltext{line-height:1}
.schooltext .small{font:300 var(--hamSmall)/1 Oswald;letter-spacing:.02em;color:var(--muted)}
.schooltext .big1{font:400 var(--hamBig)/1 "Bebas Neue",sans-serif}
.schooltext .big2{font:400 var(--hamBigger)/1 "Bebas Neue",sans-serif;margin-top:-4px}
.crumbs{font:300 calc(var(--hamSmall)*.5)/1 Oswald;letter-spacing:.02em;color:var(--muted);text-transform:uppercase}
.hero{padding:2px 0}
.hero-grid{display:flex;align-items:center;justify-content:space-between;gap:16px}
.hero-left{display:flex;flex-direction:column;gap:4px}
.hero-crumbs{margin:0; text-align:left; white-space:nowrap}
@media (max-width: 768px) {
    .topbar .crumbs { display: block; }
    .hero-left .crumbs { display: none; }
}
@media (min-width: 769px) {
    .topbar .crumbs { display: none; }
    .hero-left .crumbs { display: block; }
}
.tag-duo{position:relative;height:1.8em}
.tag-swap{position:absolute;left:0;top:0;right:0;opacity:0;animation:swap 6s infinite;white-space:nowrap}
.tag-swap:nth-child(1){animation-delay:0s}
.tag-swap:nth-child(2){animation-delay:3s}
.tag-grey{font:300 1em Oswald,sans-serif;letter-spacing:.02em;color:var(--tagGrey)}
.tag-bold{font:400 1em Indigo,"Bebas Neue",sans-serif}
@keyframes swap{0%{opacity:0}5%{opacity:1}45%{opacity:1}50%{opacity:0}100%{opacity:0}}
.hero-right{display:flex;gap:10px}
.hero-icon i{font-size:20px}
.drawer-mask{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity .2s;z-index:60}
.drawer{position:fixed;top:0;bottom:0;width:min(360px,82vw);background:rgba(10,10,10,.65);backdrop-filter:blur(4px);color:#e8e8e8;transform:translateX(-110%);transition:transform .25s;z-index:70}
.drawer-right{right:0;left:auto;transform:translateX(110%); display: flex; flex-direction: column; height: 100%;}
.drawer h3{margin:18px 16px 8px; padding-right: 30px;}
.drawer .pad { padding: 10px 16px; }
.drawer .close-btn { position: absolute; top: 12px; right: 12px; }
.drawer a{color:#e8e8e8}
.drawer a:hover{color:#fff}
body.drawer-left-open .drawer-mask,body.drawer-right-open .drawer-mask{opacity:1;pointer-events:auto}
body.drawer-left-open #drawerLeft{transform:translateX(0)}
body.drawer-right-open .drawer-right{transform:translateX(0)}
.drawer-content { flex-grow: 1; overflow-y: auto; padding: 10px 16px;}
.drawer-footer { flex-shrink: 0; padding: 12px 16px; border-top: 1px solid var(--line); background: rgba(10,10,10,.8); display:flex; gap: 10px; align-items: center;}
.filter-group { border-bottom: 1px solid var(--line); }
.filter-group:last-of-type { border-bottom: none; }
.filter-title { padding: 14px 0; cursor: pointer; font-weight: 700; font-family: "Bebas Neue", sans-serif; letter-spacing: .05em; list-style: none; display: flex; justify-content: space-between; align-items: center; }
.filter-title::-webkit-details-marker { display: none; }
.filter-title::after { content: '▸'; font-size: 1.2em; transition: transform 0.2s; }
details[open] > .filter-title::after { transform: rotate(90deg); }
.filter-options { padding: 4px 0 16px 0; }
.filter-options label { display: block; margin-bottom: 8px; padding-left: 4px;}
.filter-options input[type=checkbox] { margin-right: 8px; transform: scale(1.1); }
.select-all-label { font-weight: bold; border-bottom: 1px solid var(--line); padding-bottom: 8px !important; margin-bottom: 12px !important;}
#liveResults{margin:10px 4px 18px;max-height:55vh;overflow:auto}
.live-hit{padding:10px 12px;display:flex;align-items:center;gap:10px;border-radius:10px;cursor:pointer}
.live-hit:hover{background:rgba(255,255,255,.08)}
.live-hit img{width:36px;height:36px;border-radius:6px;object-fit:cover}
.auth-tabs { display: flex; border-bottom: 1px solid var(--line); }
.auth-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; background: transparent; border: none; color: var(--muted); font-family: "Bebas Neue", sans-serif; font-size: 16px; letter-spacing: .05em;}
.auth-tab.active { color: var(--fg); border-bottom: 2px solid var(--fg); }
.auth-form { display: none; }
.auth-form.active { display: block; }
.form-field { margin-bottom: 15px; }
.form-field label { display: block; margin-bottom: 5px; font-size: 12px; }
.form-field input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--line); background: rgba(255,255,255,.06); color: var(--ink); }
.auth-btn { width: 100%; padding: 12px; background: var(--fg); color: var(--bg); border: none; border-radius: 8px; font-family: "Bebas Neue", sans-serif; font-size: 16px; letter-spacing: .08em; cursor: pointer; }
#authMessage { margin-top: 15px; text-align: center; font-size: 13px; }
.error { color: #fca5a5; }
.success { color: #86efac; }
.main{padding:8px 0 calc(var(--footerH) + 12px)}
.grid{display:grid;gap:14px; grid-template-columns: repeat(5, 1fr);}
@media (max-width: 1400px) { .grid { grid-template-columns: repeat(4, 1fr); } }
@media (max-width: 1100px) { .grid { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 768px) { .grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 520px) { .grid { grid-template-columns: repeat(1, 1fr); } }

.card{position:relative;background:#171717;border-radius:0;overflow:hidden}
.card::before{content:"";display:block;padding-top:140%}
.card-inner{position:absolute;inset:0;perspective:1200px}
.flip{position:absolute;inset:0;transform-style:preserve-3d;transition:transform .6s cubic-bezier(.2,.7,.2,1)}
.card.is-flipped .flip{transform:rotateY(180deg)}
.face{position:absolute;inset:0;backface-visibility:hidden}
.card:not(.is-flipped) .back { pointer-events: none; }
.card.is-flipped .front { pointer-events: none; }
.card .back a, .card .back button { pointer-events: auto; }
.face.front { display: flex; flex-direction: column; justify-content: flex-end; }
.bg{position:absolute;inset:0;background:#111 center/cover no-repeat}
.shade{position:absolute;left:0;right:0;bottom:0;height:70%;background:linear-gradient(transparent,rgba(0,0,0,.3) 30%,rgba(0,0,0,.95))}
.name{font:400 28px/1 "Indigo","Bebas Neue",sans-serif;letter-spacing:.02em; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,.5);}
.name span { display: block; line-height: .9; }
.meta-small{font:300 13px/1.2 Oswald;opacity:.9; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,.5); margin-top: 4px;}
.meta-small span { display: block; line-height: 1.1; }
.front-bottom-content { position: relative; z-index: 2; padding: 16px; display: flex; align-items: flex-end; width: 100%;}
.front-info-left { flex-grow: 1; display: flex; flex-direction: column; gap: 6px; }
.front-info-right { flex-shrink: 0; display: flex; flex-direction: column; gap: 4px; align-items: flex-end; margin-left: 12px;}
.front-chips-row { display: flex; flex-direction: column; gap: 4px; align-items: flex-start;}
.front-chip { background: rgba(0,0,0,.5); color: #fff; border-radius: 6px; padding: 2px 6px; font-weight: 700; font-size: 10px; font-family: Oswald, sans-serif; border: 1px solid rgba(255,255,255,.15); text-transform: uppercase; }
.game-title-pill { background: rgba(0,0,0,.5); color: #fff; border-radius: 20px; padding: 3px 10px; font-size: 10px; font-family: Oswald, sans-serif; border: 1px solid rgba(255,255,255,.15); text-transform: uppercase; font-weight: 700; display: inline-block; }
.game-data-text { font: 300 13px/1.2 Oswald; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,.5); text-align: right; }
.game-data-text span { display: block; }
.game-log { font: 400 10px system-ui, sans-serif; white-space: nowrap; line-height: 1.2; letter-spacing: -0.5px; }
.varsity-dots { display: flex; gap: 4px; }
.varsity-dot { width: 22px; height: 22px; border-radius: 50%; background: #fff; color: #111; display: grid; place-items: center; font-weight: 700; font-size: 10px; border: 1px solid rgba(0,0,0,.2); }
.face.back{transform:rotateY(180deg); background: #fff; color: #111; display: flex; flex-direction: column;}
.back-top-section { display: flex; padding: 12px; gap: 12px; background: #fff; color: #111; border-bottom: 1px solid #eee;}
.back-info-left { flex-grow: 1; }
.back-player-name { font: 700 22px "Bebas Neue", sans-serif; letter-spacing: .04em; margin-bottom: 4px;}
.back-player-details { font-size: 12px; opacity: .8; line-height: 1.4; }
.back-player-details strong { font-weight: 700; }
.back-photo-right { flex-shrink: 0; }
.back-player-photo { width: 100px; height: 140px; object-fit: cover; border-radius: 8px; border: 4px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,.2);}
.fun-zone { flex-grow: 1; overflow-y: auto; }
.back-nav { display: flex; justify-content: space-around; background: #f7f7f7; border-bottom: 1px solid #eee; }
.back-nav-link { background: none; border: none; color: #555; font: 700 11px "Bebas Neue", sans-serif; letter-spacing: .05em; cursor: pointer; padding: 8px 6px; border-radius: 0; border-bottom: 2px solid transparent;}
.back-nav-link.active { color: #111; border-bottom-color: #111; }
.stats-header-bar { background: #e5e5e5; color: #333; text-align: center; padding: 6px; font: 700 12px "Bebas Neue", sans-serif; letter-spacing: .08em; margin: 12px; }
.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; font-family: Oswald, sans-serif; text-align: center; padding: 0 12px 12px;}
.stat-item { background: #f0f0f0; border-radius: 6px; padding: 5px; }
.stat-value { font-size: 14px; font-weight: 700; }
.stat-label { font-size: 10px; text-transform: uppercase; opacity: .7; }
.site-footer{position:fixed;left:0;right:0;bottom:0;height:var(--footerH);background:#0b0b0b;border-top:1px solid var(--line);z-index:40}
.site-footer .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:0 var(--containerPad)}
.sponsor-banner{height:calc(var(--footerH) - 12px); width:100%; display:flex;align-items:center;justify-content:center}
.sponsor-banner img{ height:100%; width:100%; object-fit:contain; filter: saturate(.95); }
@media (max-width: 768px) {
    .name { font-size: 22px; line-height: 0.95; }
    .meta-small { font-size: 11px; }
    .stat-value { font-size: 12px; } /* For back stats grid */
    .stat-label { font-size: 9px; }
}
@media (max-width: 520px) {
    .name { font-size: 18px; }
}
.front-chips-row { flex-wrap: wrap; max-width: 100%; align-items: flex-start; }
.varsity-dots { flex-wrap: wrap; gap: 3px; }
@media (max-width: 768px) {
    .front-chip { font-size: 9px; padding: 1px 4px; }
    .varsity-dot { width: 18px; height: 18px; font-size: 9px; }
}
.icon-btn:focus, button:focus, input:focus, details summary:focus {
    outline: 2px solid var(--fg);
    outline-offset: 2px;
}
.card:focus { outline: 2px solid var(--fg); } /* For card flips via keyboard */

/* --- New Splash Screen Styles --- */
#splashScreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  background-color: #000;
  z-index: 1000;
  opacity: 1;
  transition: opacity 0.8s ease-out;
  pointer-events: auto;
  overflow: hidden; /* Hide overflowing shimmer */
}

#splashScreen.is-hidden {
  opacity: 0;
  pointer-events: none;
}

.splash-top {
  position: absolute;
  width: 100%;
  top: 33%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.splash-bottom {
  position: absolute;
  width: 100%;
  bottom: 33%;
  left: 50%;
  transform: translate(-50%, 50%);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: clamp(12px, 4vw, 20px);
}

.splash-top .logo-container {
  position: relative; /* Needed for shimmer effect */
  display: inline-block; /* Fit to logo size */
  overflow: hidden; /* Contain shimmer effect */
}

.splash-top .splash-logo-main {
  width: clamp(280px, 70vw, 450px);
  height: auto;
  /* Faint glow effect */
  filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.2));
  animation: pulse-glow 2.5s infinite ease-in-out;
}

/* Shimmer Effect */
.shimmer::after {
  content: '';
  position: absolute;
  top: 0;
  left: -150%;
  width: 70%;
  height: 100%;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0) 100%
  );
  transform: skewX(-25deg);
  animation: shimmer-effect 4s infinite;
  animation-delay: 1.5s;
}

.splash-bottom .splash-logo-h {
  height: clamp(50px, 12vw, 70px);
  width: auto;
}

.splash-bottom .splash-divider,
.splash-bottom .splash-logo-ne {
    animation: fadeInDelayed 1.5s ease-in-out forwards;
    animation-delay: 1.2s;
    opacity: 0;
}

.splash-bottom .splash-divider {
  width: 2px;
  height: clamp(40px, 10vw, 60px);
  background-color: rgba(255,255,255,0.5);
}

.splash-bottom .splash-logo-ne {
  height: clamp(40px, 9vw, 55px);
  width: auto;
}

@keyframes fadeInDelayed {
    to { opacity: 1; }
}
@keyframes pulse-glow {
    0% { filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.2)); }
    50% { filter: drop-shadow(0 0 25px rgba(255, 255, 255, 0.4)); }
    100% { filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.2)); }
}
@keyframes shimmer-effect {
    100% { left: 150%; }
}
</style>
</head>

<body>
<div id="splashScreen">
  <div class="splash-top">
    <div class="logo-container shimmer">
      <img src="assets/img/yatstats-logo.png" alt="YAT?STATS Logo" class="splash-logo-main">
    </div>
  </div>
  <div class="splash-bottom">
    <img src="assets/img/hamilton-logo.png" alt="Hamilton Huskies Logo" class="splash-logo-h">
    <div class="splash-divider"></div>
    <img src="assets/img/partners/no-errors.png" alt="No Errors Logo" class="splash-logo-ne">
  </div>
</div>
<header class="header">
    <div class="container topbar">
        <div class="left-icons">
            <button class="icon-btn" id="btnMenu" aria-label="Menu"><i class="ri-menu-line"></i></button>
            <div id="auth-container">
                <button class="icon-btn" id="btnAccount" aria-label="Account"><i class="ri-user-3-line"></i></button>
                <button class="icon-btn" id="btnSignOut" style="display: none;"><i class="ri-logout-box-line"></i></button>
            </div>
             <div class="crumbs">HAMILTON ▸ WHERE THEY YAT?</div>
        </div>
        <nav class="topnav" aria-label="Top Navigation">
            <a href="index.html" class="nav-pair"><span class="thin">WHERE THEY</span><span class="bold">YAT?</span></a>
            <a href="alumni-news.html" class="nav-pair"><span class="thin">ACTIVE ALUMNI</span><span class="bold">NEWS</span></a>
            <a href="all-time-list.html" class="nav-pair"><span class="thin">NEXT-LEVEL</span><span class="bold">ALL-TIME LIST</span></a>
            <a href="marketplace.html" class="nav-pair"><span class="thin">NIL & YAT-A-BOY</span><span class="bold">MARKETPLACE</span></a>
            <a href="current-team.html" class="nav-pair"><span class="thin">THE</span><span class="bold">CURRENT TEAM</span></a>
            <a href="partner-program.html" class="nav-pair"><span class="thin">PCD ACTION</span><span class="bold">PARTNER PROGRAM</span></a>
            <a href="faq.html" class="nav-pair"><span class="bold">FAQ’S</span></a>
        </nav>
        <div class="wordmark-wrap">
            <img class="wordmark-img" src="assets/img/yatstats-logo.png" alt="YAT?STATS">
        </div>
    </div>
    <div class="hr-y"></div>
    <div class="container schoolrow">
        <img id="hamLogo" class="ham-logo" src="assets/img/hamilton-logo.png" alt="Hamilton H">
        <div class="schooltext">
            <div class="small">CHANDLER, AZ</div>
            <div class="big1">HAMILTON HIGH SCHOOL</div>
            <div class="big2">ACTIVE BASEBALL ALUMNI</div>
        </div>
    </div>
    <div class="hr-y"></div>
    <section class="hero">
        <div class="container hero-grid">
            <div class="hero-left" aria-live="polite">
                <div class="tag-duo">
                    <div class="tag-swap"><span class="tag-grey">WHERE THEY</span> <span class="tag-bold">YAT?</span></div>
                    <div class="tag-swap"><span class="tag-grey">FLIP FOR</span> <span class="tag-bold">STATS!</span></div>
                </div>
                <div class="crumbs hero-crumbs">HAMILTON ▸ WHERE THEY YAT?</div>
            </div>
            <div class="hero-right">
                <button id="openSearch" class="hero-icon icon-btn" aria-label="Open search"><i class="ri-search-line"></i></button>
                <button id="openFilters" class="hero-icon icon-btn" aria-label="Open filters"><i class="ri-filter-3-line"></i></button>
                <button id="filtersReset2" class="hero-icon icon-btn" aria-label="Reset"><i class="ri-restart-line"></i></button>
            </div>
        </div>
    </section>
</header>

<div class="drawer-mask"></div>
<aside class="drawer" id="drawerLeft" aria-label="Left drawer">
    <button class="icon-btn close-btn"><i class="ri-close-line"></i></button>
    <div class="drawer-content">
        <h3>PLAYER PROFILE SEARCH</h3>
        <div class="pad">
            <input id="playerSearch" placeholder="Type to search…" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--ink)">
            <div id="liveResults"></div>
        </div>
        <h3>NAVIGATION</h3>
        <div class="pad" style="display:flex;flex-direction:column;gap:12px">
            <a href="index.html" class="nav-pair"><span class="thin">WHERE THEY</span><span class="bold">YAT?</span></a>
            <a href="alumni-news.html" class="nav-pair"><span class="thin">ACTIVE ALUMNI</span><span class="bold">NEWS</span></a>
            <a href="all-time-list.html" class="nav-pair"><span class="thin">NEXT-LEVEL</span><span class="bold">ALL-TIME LIST</span></a>
            <a href="marketplace.html" class="nav-pair"><span class="thin">NIL & YAT-A-BOY</span><span class="bold">MARKETPLACE</span></a>
            <a href="current-team.html" class="nav-pair"><span class="thin">THE</span><span class="bold">CURRENT TEAM</span></a>
            <a href="partner-program.html" class="nav-pair"><span class="thin">PCD ACTION</span><span class="bold">PARTNER PROGRAM</span></a>
            <a href="faq.html" class="nav-pair"><span class="bold">FAQ’S</span></a>
        </div>
    </div>
</aside>

<aside class="drawer drawer-right" id="drawerFilters" style="display: flex;">
    <button class="icon-btn close-btn"><i class="ri-close-line"></i></button>
    <h3>FILTERS</h3>
    <div class="drawer-content" id="filters">
        <details class="filter-group" open>
            <summary class="filter-title">By Name</summary>
            <div class="filter-options">
                <input id="filterName" placeholder="Type a name…" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--ink)"/>
            </div>
        </details>
        <details class="filter-group">
            <summary class="filter-title">By Level</summary>
            <div class="filter-options" id="filterLevels">
                 <label class="select-all-label"><input type="checkbox" class="select-all"> Select All</label>
                 </div>
        </details>
        <details class="filter-group">
            <summary class="filter-title">By Graduating Class</summary>
            <div class="filter-options" id="filterGradClass"></div>
        </details>
        <details class="filter-group">
            <summary class="filter-title">By Roster Year</summary>
            <div class="filter-options" id="filterRosterYear"></div>
        </details>
         <details class="filter-group">
            <summary class="filter-title">By Status</summary>
            <div class="filter-options" id="filterStatus">
                <label class="select-all-label"><input type="checkbox" class="select-all"> Select All</label>
                <label><input type="checkbox" value="ACTIVE 2025"> ACTIVE 2025</label>
                <label><input type="checkbox" value="ACTIVE 2024"> ACTIVE 2024</label>
                <label><input type="checkbox" value="FREE AGENT"> FREE AGENT</label>
                <label><input type="checkbox" value="INJURED"> INJURED</label>
                <label><input type="checkbox" value="RETIRED"> RETIRED</label>
                <label><input type="checkbox" value="SPONSOR"> SPONSOR</label>
            </div>
        </details>
    </div>
    <div class="drawer-footer">
        <button id="filtersReset" class="icon-btn" style="padding:10px 14px;border:1px solid var(--line);border-radius:12px"><i class="ri-restart-line"></i>&nbsp;Reset Filters</button>
    </div>
</aside>

<aside class="drawer drawer-right" id="drawerAccount" style="display: none;">
     <button class="icon-btn close-btn"><i class="ri-close-line"></i></button>
    <h3>ACCOUNT</h3>
    <div class="drawer-content">
        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="signin">Sign In</button>
            <button class="auth-tab" data-tab="register">Register</button>
        </div>
        <div id="auth-forms-container" class="pad">
            <form id="signInForm" class="auth-form active">
                <div class="form-field"><label for="signInEmail">Email</label><input type="email" id="signInEmail" required></div>
                <div class="form-field"><label for="signInPassword">Password</label><input type="password" id="signInPassword" required></div>
                <button type="submit" class="auth-btn">Sign In</button>
            </form>
            <form id="registerForm" class="auth-form">
                <div class="form-field"><label for="registerEmail">Email</label><input type="email" id="registerEmail" required></div>
                <div class="form-field"><label for="registerPassword">Password</label><input type="password" id="registerPassword" required></div>
                <button type="submit" class="auth-btn">Create Account</button>
            </form>
            <p id="authMessage"></p>
        </div>
    </div>
</aside>

<main class="main container">
  <div id="cardGrid" class="grid" aria-live="polite">
      <p style="color: var(--muted); grid-column: 1 / -1;">Loading YATSTATS players...</p>
  </div>
</main>

<footer class="site-footer">
  <div class="wrap">
    <div class="sponsor-banner">
      <img src="assets/img/partners/no-errors-banner.jpg" alt="No Errors Sponsor Banner">
    </div>
  </div>
</footer>

<script type="module">
/* ---- YATSTATS • Hamilton • build 5.0.35 ---- */

const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQcWJM6Q6hTdFnES_G5LUy4teCS-sJ5HdAc9F5HSY8DGE9egdGy8yUAe2ShT3tFm-CwUuCYeAYy_YiW/pub?gid=2028135390&single=true&output=csv";
const $ = s => document.querySelector(s), $$ = s => Array.from(document.querySelectorAll(s));
const debounce = (fn, ms=300)=>{ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; };

async function loadCSV(url){
  const response = await fetch(url);
  if(!response.ok) throw new Error(`HTTP ${response.status}`);
  const text = await response.text();
  if(!text.trim()) throw new Error('Empty CSV');
  const rows = text.trim().split(/\r?\n/).map(line => line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'')));
  const header = rows.shift().map(h => h.trim());
  const idx=n=>header.indexOf(n);
  const statKeys = ['avg', 'obp', 'slg', 'ops', 'ab', 'h', 'r', 'rbi', '2b', '3b', 'hr', 'sb', 'bb', 'era', 'k/9', 'k/bb', 'whip', 'ip', 'er', 'ko', 'gp', 'w-l', 'saves', 'fip'];
  return rows.map(r=> {
    const player = {
      slug:r[idx('slug')], display_name:r[idx('display_name')],
      first:r[idx('first')], last:r[idx('last')],
      grad_class:r[idx('grad_class')], letter_years:r[idx('letter_years')], status:r[idx('status')], level:r[idx('level')], 
      team:r[idx('team')], org:r[idx('org')], position:r[idx('position')],
      height:r[idx('height')], weight:r[idx('weight')], bats:r[idx('bats')], throws:r[idx('throws')],
      draft_info:r[idx('Draft_Info')], colleges:r[idx('Colleges')],
      next_game_opponent: r[idx('next_game_opponent')],
      next_game_datetime: r[idx('next_game_datetime')],
      last_game_1: r[idx('last_game_1')],
      last_game_2: r[idx('last_game_2')],
      last_game_3: r[idx('last_game_3')],
      x_handle: r[idx('x_handle')], ig_handle: r[idx('ig_handle')],
      stats: {}
    };
    for (const key of statKeys) {
        const statIndex = idx(key);
        if (statIndex > -1 && r[statIndex]) player.stats[key.toUpperCase()] = r[statIndex];
    }
    return player;
  });
}

function populateFilters(players) {
    const gradClasses = [...new Set(players.map(p => p.grad_class).filter(Boolean))].sort((a,b) => b-a);
    const rosterYears = [...new Set(players.flatMap(p => (p.letter_years || '').split(',')).map(y => y.trim()).filter(Boolean))].sort((a,b) => b-a);
    
    const gradClassContainer = $('#filterGradClass');
    const rosterYearContainer = $('#filterRosterYear');

    gradClassContainer.innerHTML = '<label class="select-all-label"><input type="checkbox" class="select-all"> Select All</label>' + gradClasses.map(year => `<label><input type="checkbox" value="${year}"> ${year}</label>`).join('');
    rosterYearContainer.innerHTML = '<label class="select-all-label"><input type="checkbox" class="select-all"> Select All</label>' + rosterYears.map(year => `<label><input type="checkbox" value="${year}"> ${year}</label>`).join('');
}

function imageNameOf(p) {
    const first = (p.first || '').toLowerCase();
    const last = (p.last || '').toLowerCase();
    return (first && last) ? `${first}_${last}` : slugOf(p);
}

function cardHTML(p){
  const name = p.display_name || 'Player Name';
  const imageName = imageNameOf(p);
  const bg_now_jpg = `assets/img/now_players/${imageName}.jpg`;
  const bg_now_png = `assets/img/now_players/${imageName}.png`;
  const bg_hs_jpg = `assets/img/hs_players/${imageName}.jpg`;
  const bg_hs_png = `assets/img/hs_players/${imageName}.png`;
  const klass = p.grad_class || '';
  const org = p.org ? p.org : (p.conference || '');
  const playerInfo = JSON.stringify(p).replace(/'/g, "&apos;");
  const letterYears = (p.letter_years || '').split(',').map(y => y.trim().slice(-2)).filter(Boolean);
  const isRetired = (p.status || '').toUpperCase() === 'RETIRED';

  return `
  <article class="card" aria-label="${name}" data-player-info='${playerInfo}'>
    <div class="card-inner">
      <div class="flip">
        <div class="face front">
          <div class="bg" style="background-image:url('${bg_now_jpg}')" onerror="this.onerror=null; this.style.backgroundImage='url(${bg_now_png})'"></div>
          <div class="shade"></div>
          <div class="front-bottom-content">
            <div class="front-info-left">
                  <div class="name"><span>${p.first}</span><span>${p.last}</span></div>
                  <div class="meta-small"><span>${p.team||''}</span><span>${org}</span></div>
                  <div class="varsity-dots">
                    ${letterYears.map(year => `<div class="varsity-dot">${year}</div>`).join('')}
                  </div>
                  <div class="front-chips-row">
                    ${klass?`<span class="front-chip">CLASS OF ${klass}</span>`:''}
                    ${p.status?`<span class="front-chip">${p.status}</span>`:''}
                    ${p.level?`<span class="front-chip">${p.level}</span>`:''}
                  </div>
            </div>
            <div class="front-info-right">
                ${!isRetired ? `
                    <div class="game-title-pill">NEXT GAME</div>
                    <div class="game-data-text">
                        <span>${p.next_game_datetime || 'TBD'}</span>
                        <span>${p.next_game_opponent || ''}</span>
                    </div>` : ''}
                <div class="game-title-pill" style="margin-top: 8px;">LAST 3 GAMES</div>
                <div class="game-data-text">
                    <span class="game-log">${p.last_game_1 || '--'}</span>
                    <span class="game-log">${p.last_game_2 || '--'}</span>
                    <span class="game-log">${p.last_game_3 || '--'}</span>
                </div>
            </div>
          </div>
        </div>
        <div class="face back">
            <div class="back-top-section">
                <div class="back-info-left">
                    <div class="back-player-name">${name}</div>
                    <div class="back-player-details">
                        <strong>${p.team || ''}</strong> - ${org}<br>
                        ${p.level} - ${p.status}<br>
                        ${p.position || ''} | H: ${p.height || '--'} | W: ${p.weight || '--'} | B/T: ${p.bats||'--'}/${p.throws||'--'}
                    </div>
                     <div class="back-player-details" style="margin-top: 8px;">
                        <strong>Draft:</strong> ${p.draft_info || 'N/A'}<br>
                        <strong>Colleges:</strong> ${p.colleges || 'N/A'}
                    </div>
                </div>
                <div class="back-photo-right">
                    <a href="${profileURL(p)}">
                      <img src="${bg_hs_jpg}" class="back-player-photo" alt="${name}" onerror="this.onerror=null; this.src='${bg_hs_png}'">
                    </a>
                </div>
            </div>
            <nav class="back-nav">
                <button class="back-nav-link active" data-content="stats">STATS</button>
                <button class="back-nav-link" data-content="bio">BIO</button>
                <button class="back-nav-link" data-content="news">NEWS</button>
                <button class="back-nav-link" data-content="social">SOCIAL</button>
                <button class="back-nav-link" data-content="nil">NIL PTS</button>
                <button class="back-nav-link" data-content="video">VIDEO</button>
                <button class="back-nav-link" data-content="pics">FAN PICS</button>
            </nav>
            <div class="fun-zone">${generateStatsGridHTML(p)}</div>
        </div>
      </div>
    </div>
  </article>`;
}

function generateStatsGridHTML(player) {
    const isPitcher = player.stats['ERA'] !== undefined;
    const batterStats = ['AVG', 'OBP', 'SLG', 'OPS', 'H', 'R', 'HR', 'RBI', 'AB', '2B', '3B', 'SB'];
    const pitcherStats = ['ERA', 'K/9', 'K/BB', 'WHIP', 'IP', 'ER', 'KO', 'BB', 'GP', 'W-L', 'SAVES', 'FIP'];
    
    const statsToShow = isPitcher ? pitcherStats : batterStats;
    
    let grid = `<div class="stats-header-bar">${(player.status || '').includes('ACTIVE') ? '2025 SEASON STATS' : 'CAREER STATS'}</div>`;
    grid += '<div class="stats-grid">';
    
    let hasStats = false;
    for (const stat of statsToShow) {
        if (player.stats[stat]) {
            hasStats = true;
            grid += `<div class="stat-item"><div class="stat-value">${player.stats[stat]}</div><div class="stat-label">${stat}</div></div>`;
        }
    }

    if (!hasStats) {
        grid = `<div class="stats-header-bar">${(player.status || '').includes('ACTIVE') ? '2025 SEASON STATS' : 'CAREER STATS'}</div>`;
        grid += '<div class="stats-grid">';
        for (const stat of statsToShow) {
             grid += `<div class="stat-item"><div class="stat-value">--</div><div class="stat-label">${stat}</div></div>`;
        }
        grid += '</div>';
        return grid;
    }
    
    grid += '</div>';
    return grid;
}

function renderCards(list){
  const grid=$('#cardGrid'); if(!grid) return;
  if(list.length === 0) {
      grid.innerHTML = `<p style="color: var(--muted); grid-column: 1 / -1;">No players match the current filters.</p>`;
      return;
  }
  grid.innerHTML=list.map(cardHTML).join('');
}

// This object defines the sorting hierarchy for player levels. Higher numbers are better.
const levelOrder = {
    'MLB': 13,
    'KBO': 12,
    'TRIPLE-A': 11,
    'AAA': 11, // Alias for Triple-A
    'DOUBLE-A': 10,
    'AA': 10, // Alias for Double-A
    'HIGH-A': 9,
    'A+': 9, // Alias for High-A
    'LOW-A': 8,
    'A': 8, // Alias for Low-A
    'ROOKIE': 7,
    'ROK': 7, // Alias for Rookie
    'INDY': 6,
    'NCAA-D1': 5,
    'NCAA-D2': 4,
    'NCAA-D3': 3,
    'NAIA': 2,
    'JUCO': 1
};

function defaultSort(a, b) {
    // Determine if players are in the priority group (Active or Free Agent)
    const aIsPriority = (a.status || '').toUpperCase().includes('ACTIVE') || (a.status || '').toUpperCase() === 'FREE AGENT';
    const bIsPriority = (b.status || '').toUpperCase().includes('ACTIVE') || (b.status || '').toUpperCase() === 'FREE AGENT';

    // If one is priority and the other isn't, the priority one comes first.
    if (aIsPriority && !bIsPriority) return -1;
    if (!aIsPriority && bIsPriority) return 1;

    // If both are priority players, apply the detailed sorting logic.
    if (aIsPriority && bIsPriority) {
        // Standardize the level text before lookup: convert to uppercase and trim whitespace.
        const levelTextA = (a.level || '').toUpperCase().trim();
        const levelTextB = (b.level || '').toUpperCase().trim();
        
        // 1. Sort by Level (highest first)
        const levelA = levelOrder[levelTextA] ?? -1;
        const levelB = levelOrder[levelTextB] ?? -1;
        if (levelA !== levelB) return levelB - levelA;

        // 2. Sort by Grad Class (oldest first, e.g., 2019 before 2020)
        const gradA = parseInt(a.grad_class, 10) || 0;
        const gradB = parseInt(b.grad_class, 10) || 0;
        if (gradA !== gradB) return gradA - gradB;

        // 3. Sort by number of Varsity Letters (most first)
        const lettersA = (a.letter_years || '').split(',').filter(Boolean).length;
        const lettersB = (b.letter_years || '').split(',').filter(Boolean).length;
        if (lettersA !== lettersB) return lettersB - lettersA;

        // 4. Sort by Name (alphabetically)
        return (a.display_name || '').localeCompare(b.display_name || '');
    }

    // Fallback for non-priority players (e.g., Retired, Sponsor).
    const cA = +a.grad_class || 9999,
          cB = +b.grad_class || 9999;
    if (cA !== cB) return cA - cB;
    return (a.display_name || '').localeCompare(b.display_name || '');
}

function closeDrawers() { document.body.classList.remove('drawer-left-open', 'drawer-right-open', 'drawer-open'); }

function setupEventListeners() {
    $('#btnMenu')?.addEventListener('click', () => { document.body.classList.add('drawer-left-open', 'drawer-open'); });
    $('#openSearch')?.addEventListener('click', () => { document.body.classList.add('drawer-left-open', 'drawer-open'); });
    
    $('#openFilters')?.addEventListener('click', () => {
        $('#drawerFilters').style.display = 'flex';
        $('#drawerAccount').style.display = 'none';
        document.body.classList.add('drawer-right-open', 'drawer-open');
    });
    $('#btnAccount')?.addEventListener('click', () => {
        $('#drawerAccount').style.display = 'flex';
        $('#drawerFilters').style.display = 'none';
        document.body.classList.add('drawer-right-open', 'drawer-open');
    });
    
    $$('.close-btn').forEach(btn => btn.addEventListener('click', closeDrawers));
    $('.drawer-mask')?.addEventListener('click', closeDrawers);
    $('#filtersReset')?.addEventListener('click', resetFilters);
    $('#filtersReset2')?.addEventListener('click', resetFilters);
    
    $('#filters')?.addEventListener('input', debounce(applyFilters));
    $('#playerSearch')?.addEventListener('input', debounce(liveSearch));

    $$('.filter-group').forEach(group => {
        const selectAll = group.querySelector('.select-all');
        if (!selectAll) return;
        const options = [...group.querySelectorAll('.filter-options input[type="checkbox"]:not(.select-all)')];
        selectAll.addEventListener('change', (e) => {
            options.forEach(option => { option.checked = e.target.checked; });
            debounce(applyFilters)();
        });
    });

    $('#cardGrid').addEventListener('click', (e) => {
        const card = e.target.closest('.card');
        if (!card) return;
        if (e.target.closest('.back-nav-link')) {
            handleFunZone(e.target.closest('.back-nav-link'));
            return; 
        }
        if (e.target.closest('a')) return;
        card.classList.toggle('is-flipped');
    });
}

function slugOf(p){
  if (!p) return '';
  const s=(p.slug||'').trim();
  if(s) return s;
  return (p.display_name||'').trim().toLowerCase().replace(/[^a-z0-9]+/g,'-');
}
function profileURL(p) { return `./profile.html?player=${slugOf(p)}`; }

function applyFilters(){
  if(!window.PLAYERS) return;
  const F=readFilters();
  const filtered = window.PLAYERS.filter(p=>{
    const nm=(p.display_name||'').toLowerCase();
    const nameOk=!F.name||nm.includes(F.name);
    const lvlOk=!F.levels.length||F.levels.includes(p.level);
    const statOk=!F.status.length||F.status.includes(p.status);
    const classOk=!F.classes.length||F.classes.includes(p.grad_class);
    const rosterOk=!F.rosterYears.length||(p.letter_years || '').split(',').some(y => F.rosterYears.includes(y.trim()));
    return nameOk && lvlOk && statOk && classOk && rosterOk;
  });
  renderCards(filtered.sort(defaultSort));
}

function readFilters(){
  const name=($('#filterName')?.value||'').trim().toLowerCase();
  const levels=$$('#filterLevels input:checked:not(.select-all)').map(i=>i.value);
  const status=$$('#filterStatus input:checked:not(.select-all)').map(i=>i.value);
  const classes=$$('#filterGradClass input:checked:not(.select-all)').map(i=>i.value);
  const rosterYears=$$('#filterRosterYear input:checked:not(.select-all)').map(i=>i.value);
  return {name, levels, status, classes, rosterYears};
}

function resetFilters(){
  $$('#filters input').forEach(i=> {
    if(i.type === 'checkbox') i.checked = false;
    if(i.type === 'text') i.value='';
  });
  $$('#filterStatus input[value^="ACTIVE"]').forEach(i => i.checked = true);
  applyFilters();
}

function makeHit(p){
  const el=document.createElement('div'); el.className='live-hit';
  const imageName = imageNameOf(p);
  const hsImgJpg=`assets/img/hs_players/${imageName}.jpg`;
  const hsImgPng=`assets/img/hs_players/${imageName}.png`;
  el.innerHTML=`<img src="${hsImgJpg}" onerror="this.onerror=null;this.src='${hsImgPng}';">
                <div><div style="font-weight:700">${p.display_name}</div>
                <div style="opacity:.7;font-size:.92em">${p.level||''} • Class of ${p.grad_class||''}</div></div>`;
  el.onclick=()=>window.location.href=profileURL(p);
  return el;
}
function liveSearch(){
  const q=($('#playerSearch')?.value||'').trim().toLowerCase();
  const box=$('#liveResults'); if(!box) return;
  if(!q){ box.innerHTML=''; return; }
  const hits=(window.PLAYERS||[]).filter(p=>(p.display_name||'').toLowerCase().includes(q)).slice(0,25);
  box.innerHTML=''; hits.forEach(p=>box.appendChild(makeHit(p)));
}

async function handleFunZone(button) {
    const card = button.closest('.card') || document.body;
    const funZone = card.querySelector('.fun-zone');
    const player = JSON.parse(card.dataset.playerInfo || '{}');
    const content = button.dataset.content;
    card.querySelectorAll('.back-nav-link').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    funZone.innerHTML = '<p>Loading...</p>';
    
    const { generateGeminiText } = window.gemini;

    if (content === 'stats') {
        funZone.innerHTML = generateStatsGridHTML(player);
    } else if (content === 'bio') {
        const prompt = `Act as an optimistic but knowledgeable high school baseball scout. Write a brief, 2-3 sentence scouting report for ${player.display_name}. Highlight his journey and potential future in a positive, "Yat-A-Boy!" style.`;
        funZone.innerHTML = await generateGeminiText(prompt);
    } else if (content === 'news') {
        const prompt = `Generate 2-3 recent, realistic, and positive sports news headlines for baseball player ${player.display_name}.`;
        const newsText = await generateGeminiText(prompt);
        funZone.innerHTML = newsText.split('\n').map(line => {
            if (!line.trim() || line.startsWith('*')) return '';
            const parts = line.split(' - ');
            return `<div class="news-item"><div class="news-headline">${parts[0].replace(/^\d\.\s/, '')}</div><div class="news-source">${parts[1] || 'YatStats Network'}</div></div>`
        }).join('');
    } else if (content === 'social') {
        let socialHTML = '<div class="social-links">';
        if (player.x_handle) socialHTML += `<a href="https://x.com/${player.x_handle}" target="_blank">X / Twitter</a>`;
        if (player.ig_handle) socialHTML += `<a href="https://instagram.com/${player.ig_handle}" target="_blank">Instagram</a>`;
        if (!player.x_handle && !player.ig_handle) socialHTML += 'No social media links available.';
        socialHTML += '</div>';
        const prompt = `Generate a realistic, short, and positive X/Twitter post from a baseball player like ${player.display_name} about an upcoming game or recent performance. Include a relevant hashtag like #YatABoy${player.display_name.split(' ').join('')}.`;
        const postText = await generateGeminiText(prompt);
        socialHTML += `<div class="social-post"><p><strong>Latest Post (Sample):</strong></p><p>"${postText}"</p></div>`;
        funZone.innerHTML = socialHTML;
    } else if (content === 'nil') {
        funZone.innerHTML = `<p>NIL Score for ${player.display_name} coming soon.</p>`;
    } else if (content === 'video') {
        funZone.innerHTML = `<iframe width="100%" height="215" src="https://www.youtube.com/embed/5O18C24I8o8" title="YouTube video player" frameborder="0" allowfullscreen style="border-radius: 8px;"></iframe>`;
    } else if (content === 'pics') {
        funZone.innerHTML = `<p>Fan Pics for ${player.display_name} coming soon.</p>`;
    }
}

/* --- FIREBASE AUTHENTICATION --- */
function setupAuth() {
    const { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } = window.firebaseAuth;
    const auth = window.auth;
    const signInForm = $('#signInForm'), registerForm = $('#registerForm'), signOutBtn = $('#btnSignOut'), authMessage = $('#authMessage');
    
    signInForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            await signInWithEmailAndPassword(auth, $('#signInEmail').value, $('#signInPassword').value);
            authMessage.textContent = 'Sign in successful!'; authMessage.className = 'success';
            setTimeout(() => { closeDrawers(); authMessage.textContent = ''; }, 1500);
        } catch (error) { authMessage.textContent = error.message; authMessage.className = 'error'; }
    });
    registerForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            await createUserWithEmailAndPassword(auth, $('#registerEmail').value, $('#registerPassword').value);
            authMessage.textContent = 'Registration successful!'; authMessage.className = 'success';
             setTimeout(() => { closeDrawers(); authMessage.textContent = ''; }, 1500);
        } catch (error) { authMessage.textContent = error.message; authMessage.className = 'error'; }
    });
    signOutBtn?.addEventListener('click', async () => { await signOut(auth); });

    document.addEventListener('authStateChanged', ({ detail }) => {
        const { user } = detail;
        const accountBtn = $('#btnAccount'), signOutBtn = $('#btnSignOut');
        if (user && !user.isAnonymous) {
            accountBtn.style.display = 'none';
            signOutBtn.style.display = 'inline-flex';
        } else {
            accountBtn.style.display = 'inline-flex';
            signOutBtn.style.display = 'none';
        }
    });

    $$('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const target = tab.dataset.tab;
            $$('.auth-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            $$('.auth-form').forEach(form => form.style.display = form.id === `${target}Form` ? 'block' : 'none');
            authMessage.textContent = '';
        });
    });
}

/* --- GEMINI API --- */
window.gemini = {
    async generateGeminiText(prompt) {
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;
        const payload = { contents: [{ parts: [{ text: prompt }] }] };
        try {
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { return `Error: The AI service failed to respond.`; }
            const result = await response.json();
            return result.candidates?.[0]?.content?.parts?.[0]?.text || "No response from AI.";
        } catch (error) {
            console.error('Gemini API call failed:', error);
            return 'AI service is currently unavailable.';
        }
    }
};


/* --- BOOTSTRAP --- */
document.addEventListener('DOMContentLoaded', () => {
    // --- Splash Screen Logic ---
    const splashScreen = document.querySelector('#splashScreen');
    if (splashScreen) {
        // Wait 4.5 seconds then start the fade out
        setTimeout(() => {
            splashScreen.classList.add('is-hidden');
            // Completely hide it after the fade transition ends
            splashScreen.addEventListener('transitionend', (e) => {
                // Make sure we are listening for the transition on the splashScreen itself
                if (e.target === splashScreen) {
                    splashScreen.style.display = 'none';
                }
            }, { once: true });
        }, 4500); // Time in milliseconds (4500ms = 4.5s)
    }
    // --- End Splash Screen Logic ---

    (async ()=>{
      try{
        setupEventListeners();
        setupAuth();
        const data = await loadCSV(CSV_URL);
        window.PLAYERS = data; 
        populateFilters(data);
        $$('#filterStatus input[value^="ACTIVE"]').forEach(i => i.checked = true);
        applyFilters(); 
      }catch(err){
        console.error('Initialization failed', err);
        $('#cardGrid').innerHTML = `<p style="color:red; grid-column: 1 / -1;"><strong>Error:</strong> Could not load page. ${err.message}</p>`;
      }
    })();
});
</script>
</body>
</html>