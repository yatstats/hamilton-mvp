<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Player Profile — YATSTATS</title>
<style>
  body{margin:0;font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#111;background:#f6f7f9}
  header{display:flex;align-items:center;justify-content:space-between;background:#111;color:#fff;padding:10px 14px}
  header a{color:#fff;text-decoration:none;font-weight:800}
  .wrap{max-width:980px;margin:18px auto;padding:0 14px}
  .hero{display:grid;grid-template-columns:140px 1fr;gap:16px;align-items:center;background:#fff;border-radius:12px;padding:14px}
  .hero img{width:140px;height:140px;object-fit:cover;border-radius:10px;background:#ddd}
  .name{font-weight:900;font-size:22px}
  .sub{color:#444;margin-top:4px}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:14px}
  .kv{background:#f1f3f6;border-radius:10px;padding:10px;text-align:center}
  .k{color:#667085;font-size:12px}.v{font-weight:900}
  .back{display:inline-block;margin-top:16px;font-weight:800}
</style>
</head>
<body>
<header>
  <a href="index.html">← Back to gallery</a>
  <div>YATSTATS — Profile</div>
</header>

<div class="wrap" id="app">Loading…</div>

<script>
/* minimal dataset mirror — keep in sync with index for demos */
const players = (()=>{
  try{ return JSON.parse(localStorage.getItem('playersCache')||'[]'); }catch{ return []; }
})();
function setCache(list){ try{ localStorage.setItem('playersCache', JSON.stringify(list)); }catch{} }

(async function boot(){
  // If no cache, try to fetch from same directory by scraping from opener (best-effort)
  if(!players.length && window.opener && window.opener.players){
    setCache(window.opener.players);
  }
  const id = new URL(location.href).searchParams.get('id');
  const p = (players||[]).find(x=>x.id===id) || {};
  const {team,parent} = (()=>{
    const raw=String(p.team||''); const [t,pr]=raw.split('—'); return {team:(t||raw).trim(), parent:(pr||'').trim()};
  })();

  const app=document.getElementById('app');
  if(!p.id){ app.textContent='Player not found.'; return; }

  const heroImg = p.frontImg || p.highSchoolImg || '';
  const statCells = [];
  const kv=(k,v)=>`<div class="kv"><div class="k">${k}</div><div class="v">${v??'—'}</div></div>`;
  if(p.batting){
    const b=p.batting; statCells.push(
      kv('AVG',b.avg),kv('OBP',b.obp),kv('SLG',b.slg),kv('OPS',b.ops),
      kv('H',b.hits),kv('R',b.runs),kv('HR',b.hr),kv('RBI',b.rbi)
    );
  }else{
    const x=p.pitching||{}; statCells.push(
      kv('ERA',x.era),kv('WHIP',x.whip),kv('OBA',x.oba||'—'),kv('K/BB',x.kbb||'—'),
      kv('IP',x.ip||'—'),kv('ER',x.er||'—'),kv('K',x.so||x.ko||'—'),kv('W',x.w||'—')
    );
  }

  app.innerHTML = `
    <div class="hero">
      <img src="${heroImg}" alt="${p.name}" onerror="this.style.display='none'">
      <div>
        <div class="name">${p.name}</div>
        <div class="sub">Class of ${p.graduatingClass || '—'} • ${team || ''} ${parent?('— '+parent):''}</div>
        <div class="grid">${statCells.join('')}</div>
        <a class="back" href="index.html">← Back to gallery</a>
      </div>
    </div>
  `;
})();
</script>
</body>
</html>